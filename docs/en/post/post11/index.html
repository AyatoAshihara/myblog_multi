<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  
  
  <meta name="generator" content="Wowchemy 4.8.0 for Hugo">
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Ayato Ashihara">

  
  
  
    
  
  <meta name="description" content="I found some data missing from the last data collection, so I scraped it again.">

  
  <link rel="alternate" hreflang="ja" href="../../../post/post11/">
  
  <link rel="alternate" hreflang="en-us" href="../../../en/post/post11/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="../../../js/mathjax-config.js"></script>
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js" integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="../../../css/wowchemy.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140804055-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-140804055-1', { 'anonymize_ip': true });

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="../../../en/index.webmanifest">
  <link rel="icon" type="image/png" href="../../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="../../../en/post/post11/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@vdjgdkhvskcndj">
  <meta property="twitter:creator" content="@vdjgdkhvskcndj">
  
  <meta property="og:site_name" content="京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:url" content="/en/post/post11/">
  <meta property="og:title" content="Scraping past race results on yahoo horse racing on rvest (for the second time) | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:description" content="I found some data missing from the last data collection, so I scraped it again."><meta property="og:image" content="/en/post/post11/featured.png">
  <meta property="twitter:image" content="/en/post/post11/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-07-13T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-07-13T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/en/post/post11/"
  },
  "headline": "Scraping past race results on yahoo horse racing on rvest (for the second time)",
  
  "image": [
    "/en/post/post11/featured.png"
  ],
  
  "datePublished": "2019-07-13T00:00:00Z",
  "dateModified": "2019-07-13T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Ayato Ashihara"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "京都の電子部品メーカーで働く社会人が研究に没頭するブログ",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "I found some data missing from the last data collection, so I scraped it again."
}
</script>

  

  


  
  
  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://www.cookiesandyou.com"
      }
    })});
  </script>



  





  <title>Scraping past race results on yahoo horse racing on rvest (for the second time) | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.wcDarkLightEnabled = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="../../../js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="../../../en">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="../../../en">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="../../../en/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      <li class="nav-item dropdown i18n-dropdown">
        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-globe mr-1" aria-hidden="true"></i><span class="d-none d-lg-inline">English</span></a>
        <div class="dropdown-menu">
          <div class="dropdown-item dropdown-item-active">
            <span>English</span>
          </div>
          
          <a class="dropdown-item" href="../../../post/post11/">
            <span>日本語</span>
          </a>
          
        </div>
      </li>
      

    </ul>

  </div>
</nav>



  <div class="container-fluid docs">
  <div class="row flex-xl-nowrap">

    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-script">1. Script</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
    </div>

    <main class="col-12 col-md-0 col-xl-10 py-md-3 pl-md-5 docs-content" role="main">
      <article class="article">

        




















  
  


<div class="article-container pt-3">
  <h1>Scraping past race results on yahoo horse racing on rvest (for the second time)</h1>

  

  

<div id="code-folding-buttons" class="dropdown btn-group pull-right">
  <a class="btn btn-light btn-sm dropdown-toggle" href="#" role="button" id="allCodeToggleButton"
     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Code
  </a>
  <div class="dropdown-menu" aria-labelledby="allCodeToggleButton">
    <a id="rmd-show-all-code" class="dropdown-item small" href="#">Show all</a>
    <a id="rmd-hide-all-code" class="dropdown-item small" href="#">Hide all</a>
  </div>
</div>



  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Jul 13, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    9 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="../../../en/post/post11/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="../../../en/category/%E7%AB%B6%E9%A6%AC/">競馬</a></span>
  

</div>

  














</div>


<div class="article-header container featured-image-wrapper mt-4 mb-4" style="max-width: 1024px; max-height: 517px;">
  <div style="position: relative">
    <img src="../../../en/post/post11/featured.png" alt="" class="featured-image">
    
  </div>
</div>



        <div class="article-container">

          <div class="article-style">
            <p>For the second time, I&rsquo;d like to drop past race results in rvest again. If you haven&rsquo;t seen the past articles, I suggest you look at that one first.</p>
<p>The reason I decided to take back the data this time is because I wanted to add more items to the explanatory variables when analyzing horse racing. So this time I created the program as an addition to the previous R script. The 14 new data items I added are as follows</p>
<ol>
<li>grass or dirt.</li>
<li>right-handed or left-handed.</li>
<li>race conditions (good or slight)</li>
<li>weather</li>
<li>the color of the horse&rsquo;s coat (chestnut, deer hair, etc.)</li>
<li>horse owner</li>
<li>producers</li>
<li>place of origin</li>
<li>date of birth</li>
<li>the father&rsquo;s horse</li>
<li>the mother&rsquo;s horse</li>
<li>winnings up to that race (available from 2003)</li>
<li>jockey&rsquo;s weight.</li>
<li>increase or decrease in the weight of the jockey.</li>
</ol>
<p>Actually, I haven&rsquo;t finished collecting data yet, and the R program has been running for a long time (I&rsquo;ve been running it for about 3 days). However, the program itself is running tightly and I&rsquo;ll try to introduce the script. Maybe I&rsquo;ll write the results in a postscript.</p>
<h2 id="1-script">1. Script</h2>
<p>The first step is to call the package.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Web scraping of horse racing data by rvest</span>

<span style="color:#75715e">#install.packages(&#34;rvest&#34;)</span>
<span style="color:#75715e">#if (!require(&#34;pacman&#34;)) install.packages(&#34;pacman&#34;)</span>
<span style="color:#75715e">#install.packages(&#34;beepr&#34;)</span>
<span style="color:#75715e">#install.packages(&#34;RSQLite&#34;)</span>
pacman<span style="color:#f92672">::</span><span style="color:#a6e22e">p_load</span>(qdapRegex)
<span style="color:#a6e22e">library</span>(rvest)
<span style="color:#a6e22e">library</span>(stringr)
<span style="color:#a6e22e">library</span>(dplyr)
<span style="color:#a6e22e">library</span>(beepr)
<span style="color:#a6e22e">library</span>(RSQLite)
</code></pre></div><p>I&rsquo;m pretty much warnning out, so I&rsquo;m banning it and connecting to SQLite</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># warning prohibition</span>
<span style="color:#a6e22e">options</span>(warn<span style="color:#f92672">=</span><span style="color:#ae81ff">-1</span>)

<span style="color:#75715e"># Connecting to SQLite</span>
con <span style="color:#f92672">=</span> <span style="color:#a6e22e">dbConnect</span>(<span style="color:#a6e22e">SQLite</span>(), <span style="color:#e6db74">&#34;horse_data.db&#34;</span>, synchronous<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;off&#34;</span>)
</code></pre></div><p>Since the odds are only available since 1994, the data is taken from 1994 up to the most recent date. yahoo horse racing has races organized by month, so the data is taken using that as a variable. Basically, you go to <a href="https://keiba.yahoo.co.jp/schedule/list/2018/?month=7" target="_blank" rel="noopener">List of race results for the relevant year and month</a> and then go to <a href="https://keiba.yahoo.co.jp/race/list/18020106/" target="_blank" rel="noopener">Timetable for each day of the race</a> for each day on that page. Since there are roughly a dozen or so races at each individual track, get the link and go to the <a href="https://keiba.yahoo.co.jp/race/result/1802010601/" target="_blank" rel="noopener">race results page</a> for each race. Then you will get the race results. The first step is to get a link to the timetable for each individual racecourse for each day.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">for</span>(year in <span style="color:#ae81ff">1994</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2019</span>){
  start.time <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.time</span>() <span style="color:#75715e"># calculate time</span>
  <span style="color:#75715e"># Retrieve the race results page on Yahoo!</span>
  <span style="color:#a6e22e">for </span>(k in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>){ <span style="color:#75715e"># K is for the month.</span>
    
    <span style="color:#a6e22e">tryCatch</span>(
      {
        keiba.yahoo <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_html</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;https://keiba.yahoo.co.jp/schedule/list/&#34;</span>, year,<span style="color:#e6db74">&#34;/?month=&#34;</span>,k)) <span style="color:#75715e"># Access to the list of race results for a given year and month</span>
        <span style="color:#a6e22e">Sys.sleep</span>(<span style="color:#ae81ff">2</span>)
        race_lists <span style="color:#f92672">&lt;-</span> keiba.yahoo <span style="color:#f92672">%&gt;%</span>
          <span style="color:#a6e22e">html_nodes</span>(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
          <span style="color:#a6e22e">html_attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>) <span style="color:#75715e"># Retrieve all URLs</span>
        
        <span style="color:#75715e"># Get the list of races for each day by track</span>
        race_lists <span style="color:#f92672">&lt;-</span> race_lists<span style="color:#a6e22e">[str_detect</span>(race_lists, pattern<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;race/list/\\d+/&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e"># Extracts URLs containing &#34;results&#34;.</span>
      }
      , error <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(e){signal <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>}
    )
</code></pre></div><p>Here, we only extract the links we get that contain the word result in the url. In essence, it is a link to the race tables of each racecourse. From here, we use the links to the race tables of the tracks to access that page and get the links to the pages that contain the results of all 12 races.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#a6e22e">for </span>(j in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(race_lists)){ <span style="color:#75715e"># where j is the link to the race table for the year in question.</span>
      
      <span style="color:#a6e22e">tryCatch</span>(
        {
          race_list <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_html</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;https://keiba.yahoo.co.jp&#34;</span>,race_lists[j]))
          race_url <span style="color:#f92672">&lt;-</span> race_list <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>) <span style="color:#75715e"># 全urlを取得</span>
          
          <span style="color:#75715e"># Get the URL of the race results</span>
          race_url <span style="color:#f92672">&lt;-</span> race_url<span style="color:#a6e22e">[str_detect</span>(race_url, pattern<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;result&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e"># Extracts URLs containing &#34;results&#34;.</span>
        }
        , error <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(e){signal <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>}
      )
</code></pre></div><p>Now that we have the links to the results of each race, it&rsquo;s time to get the race results and the formatting part of the code. It&rsquo;s quite a long and complicated code. The race results are stored in the following table attributes, so we&rsquo;ll simply pull them first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">      <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(race_url)){ <span style="color:#75715e"># where i is the race that was held at the racecourse in question</span>
        
        <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">str_c</span>(year, <span style="color:#e6db74">&#34;/&#34;</span>, k, <span style="color:#e6db74">&#34;/&#34;</span>,j, <span style="color:#e6db74">&#34; group &#34;</span>, i,<span style="color:#e6db74">&#34; order&#34;</span>))
        
        <span style="color:#a6e22e">tryCatch</span>(
          {
            race1 <span style="color:#f92672">&lt;-</span>  <span style="color:#a6e22e">read_html</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;https://keiba.yahoo.co.jp&#34;</span>,race_url[i])) <span style="color:#75715e"># Get the URL of the race results</span>
            signal <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
            <span style="color:#a6e22e">Sys.sleep</span>(<span style="color:#ae81ff">2</span>)
          }
          , error <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(e){signal <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>}
        )
        
        <span style="color:#75715e"># If the race is aborted or there are no errors in the process so far, run the process</span>
        <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">identical</span>(race1 <span style="color:#f92672">%&gt;%</span>
                      <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//div[@class = &#39;resultAtt mgnBL fntSS&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span>
                      <span style="color:#a6e22e">html_text</span>(),<span style="color:#a6e22e">character</span>(<span style="color:#ae81ff">0</span>)) <span style="color:#f92672">==</span> <span style="color:#66d9ef">TRUE</span> <span style="color:#f92672">&amp;&amp;</span> signal <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
          
          <span style="color:#75715e"># Scraping the race results</span>
          race_result <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//table[@id = &#39;raceScore&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span>
            <span style="color:#a6e22e">html_table</span>()
          race_result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>(<span style="color:#e6db74">&#34;data.frame&#34;</span>,race_result) <span style="color:#75715e"># Change the list to a data frame.</span>
          
          <span style="color:#a6e22e">colnames</span>(race_result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;order&#34;</span>,<span style="color:#e6db74">&#34;frame_number&#34;</span>,<span style="color:#e6db74">&#34;horse_number&#34;</span>,<span style="color:#e6db74">&#34;horse_name/age&#34;</span>,<span style="color:#e6db74">&#34;time/margin&#34;</span>,<span style="color:#e6db74">&#34;passing_rank/last_3F&#34;</span>,<span style="color:#e6db74">&#34;jockey/weight&#34;</span>,<span style="color:#e6db74">&#34;popularity/odds&#34;</span>,<span style="color:#e6db74">&#34;trainer&#34;</span>) <span style="color:#75715e">#　column renaming</span>
</code></pre></div><p>If you just get a table, it will not be useful for analysis because of the following \n or multiple information in one cell. So, we need to mold the data into a form.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">          <span style="color:#75715e"># Passing order and time for 3 furlongs uphill</span>
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,passing_rank<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`passing_rank/last_3F`,<span style="color:#e6db74">&#34;(\\d{2}-\\d{2}-\\d{2}-\\d{2})|(\\d{2}-\\d{2}-\\d{2})|(\\d{2}-\\d{2})&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,last_3F<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`passing_rank/last_3F`,<span style="color:#e6db74">&#34;\\d{2}\\.\\d&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> race_result[<span style="color:#ae81ff">-6</span>]
          
          <span style="color:#75715e"># Time and Difference</span>
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,time<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`time/margin`,<span style="color:#e6db74">&#34;\\d\\.\\d{2}\\.\\d|\\d{2}\\.\\d&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,margin<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`time/margin`,<span style="color:#e6db74">&#34;./.馬身|.馬身|.[:space:]./.馬身|[ア-ン-]+&#34;</span>)))
          race_result<span style="color:#f92672">$</span>margin[race_result<span style="color:#f92672">$</span>order<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;トップ&#34;</span>
          race_result<span style="color:#f92672">$</span>margin[race_result<span style="color:#f92672">$</span>margin<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;character(0)&#34;</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;大差&#34;</span>
          race_result<span style="color:#f92672">$</span>margin[race_result<span style="color:#f92672">$</span>order<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
          race_result <span style="color:#f92672">&lt;-</span> race_result[<span style="color:#ae81ff">-5</span>]
          
          <span style="color:#75715e"># Horse&#39;s name, age and weight</span>
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,horse_name<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`horse_name/age`,<span style="color:#e6db74">&#34;[ァ-ヴー・]+&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,horse_age<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`horse_name/age`,<span style="color:#e6db74">&#34;牡\\d+|牝\\d+|せん\\d+&#34;</span>)))
          race_result<span style="color:#f92672">$</span>horse_sex <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_extract</span>(race_result<span style="color:#f92672">$</span>horse_age, pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;牡|牝|せん&#34;</span>)
          race_result<span style="color:#f92672">$</span>horse_age <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_extract</span>(race_result<span style="color:#f92672">$</span>horse_age, pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\\d&#34;</span>)
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,horse_weight<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`horse_name/age`,<span style="color:#e6db74">&#34;\\d{3}&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,horse_weight_change<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`horse_name/age`,<span style="color:#e6db74">&#34;\\([\\+|\\-]\\d+\\)|\\([\\d+]\\)&#34;</span>)))
          race_result<span style="color:#f92672">$</span>horse_weight_change <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>(<span style="color:#a6e22e">rm_round</span>(race_result<span style="color:#f92672">$</span>horse_weight_change, extract<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>), paste, collapse<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,brinker<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`horse_name/age`,<span style="color:#e6db74">&#34;B&#34;</span>)))
          race_result<span style="color:#f92672">$</span>brinker[race_result<span style="color:#f92672">$</span>brinker<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;B&#34;</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;N&#34;</span>
          race_result <span style="color:#f92672">&lt;-</span> race_result[<span style="color:#ae81ff">-4</span>]
          
          <span style="color:#75715e"># jockey</span>
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,jockey<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`jockey/weight`,<span style="color:#e6db74">&#34;[ぁ-ん一-龠]+\\s[ぁ-ん一-龠]+|[:upper:].[ァ-ヶー]+&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,jockey_weight<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`jockey/weight`,<span style="color:#e6db74">&#34;\\d{2}&#34;</span>)))
          race_result<span style="color:#f92672">$</span>jockey_weight_change <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
          race_result<span style="color:#f92672">$</span>jockey_weight_change<span style="color:#a6e22e">[str_detect</span>(race_result<span style="color:#f92672">$</span>`jockey/weight`,<span style="color:#e6db74">&#34;☆&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
          race_result<span style="color:#f92672">$</span>jockey_weight_change<span style="color:#a6e22e">[str_detect</span>(race_result<span style="color:#f92672">$</span>`jockey/weight`,<span style="color:#e6db74">&#34;△&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
          race_result<span style="color:#f92672">$</span>jockey_weight_change<span style="color:#a6e22e">[str_detect</span>(race_result<span style="color:#f92672">$</span>`jockey/weight`,<span style="color:#e6db74">&#34;△&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">3</span>
          race_result <span style="color:#f92672">&lt;-</span> race_result[<span style="color:#ae81ff">-4</span>]
          
          <span style="color:#75715e"># Odds and popularity</span>
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,odds<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`popularity/odds`,<span style="color:#e6db74">&#34;\\(.+\\)&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,popularity<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_result<span style="color:#f92672">$</span>`popularity/odds`,<span style="color:#e6db74">&#34;\\d+[^(\\d+.\\d)]&#34;</span>)))
          race_result<span style="color:#f92672">$</span>odds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>(<span style="color:#a6e22e">rm_round</span>(race_result<span style="color:#f92672">$</span>odds, extract<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>), paste, collapse<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
          race_result <span style="color:#f92672">&lt;-</span> race_result[<span style="color:#ae81ff">-4</span>]
</code></pre></div><p>Next, we&rsquo;ll import information other than the table we just retrieved. Specifically, race names, weather conditions, track conditions, dates, racecourses, etc. These information are listed at the top of the race results page.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">          <span style="color:#75715e"># Race Information</span>
          race_date <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//div[@id = &#39;raceTitName&#39;]/p[@id = &#39;raceTitDay&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span>
            <span style="color:#a6e22e">html_text</span>()
          race_name <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//div[@id = &#39;raceTitName&#39;]/h1[@class = &#39;fntB&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span>
            <span style="color:#a6e22e">html_text</span>()
          race_distance <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//p[@id = &#39;raceTitMeta&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span>
            <span style="color:#a6e22e">html_text</span>()
        
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,race_date<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_date,<span style="color:#e6db74">&#34;\\d+年\\d+月\\d+日&#34;</span>)))
          race_result<span style="color:#f92672">$</span>race_date <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>race_date,<span style="color:#e6db74">&#34;年&#34;</span>,<span style="color:#e6db74">&#34;/&#34;</span>)
          race_result<span style="color:#f92672">$</span>race_date <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>race_date,<span style="color:#e6db74">&#34;月&#34;</span>,<span style="color:#e6db74">&#34;/&#34;</span>)
          race_result<span style="color:#f92672">$</span>race_date <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.Date</span>(race_result<span style="color:#f92672">$</span>race_date)
          race_course <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_date,pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;札幌|函館|福島|新潟|東京|中山|中京|京都|阪神|小倉&#34;</span>))
          race_result<span style="color:#f92672">$</span>race_course <span style="color:#f92672">&lt;-</span> race_course
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,race_name<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_replace_all</span>(race_name,<span style="color:#e6db74">&#34;\\s&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)))
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(race_result,race_distance<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_distance,<span style="color:#e6db74">&#34;\\d+m&#34;</span>)))
          race_type<span style="color:#f92672">=</span><span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_distance,pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;芝|ダート&#34;</span>))
          race_result<span style="color:#f92672">$</span>type <span style="color:#f92672">&lt;-</span> race_type
          race_turn <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(race_distance,pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;右|左&#34;</span>))
          race_result<span style="color:#f92672">$</span>race_turn <span style="color:#f92672">&lt;-</span> race_turn
          
          <span style="color:#a6e22e">if</span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg ryou&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_condition <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;良&#34;</span>
          } else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> 
                            <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg yayaomo&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_condition <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;稍重&#34;</span>
          } else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span>
                            <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg omo&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_condition <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;重&#34;</span>
          } else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> 
                            <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg furyou&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_condition <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;不良&#34;</span>
          } else race_result<span style="color:#f92672">$</span>race_condition <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;NA&#34;</span>
          
          <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg hare&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_weather <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;晴れ&#34;</span>
          } else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg ame&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_weather <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;曇り&#34;</span>
          } else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//img[@class = &#39;spBg kumori&#39;]&#34;</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            race_result<span style="color:#f92672">$</span>race_weather <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;雨&#34;</span>
          } else race_result<span style="color:#f92672">$</span>race_weather <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;その他&#34;</span>
</code></pre></div><p>The next step is to get information about each horse. In fact, the horse&rsquo;s name in the table we got earlier is a link, and if you follow the link, you can get [information about each horse] (<a href="https://keiba.yahoo.co.jp/directory/horse/2015105508/">https://keiba.yahoo.co.jp/directory/horse/2015105508/</a>) (such as coat color and date of birth).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">          horse_url <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>) 
          horse_url <span style="color:#f92672">&lt;-</span> horse_url<span style="color:#a6e22e">[str_detect</span>(horse_url, pattern<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;directory/horse&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e"># Extract only links to horse information.</span>
          
          <span style="color:#a6e22e">for </span>(l in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(horse_url)){
            <span style="color:#a6e22e">tryCatch</span>(
              {
                horse1 <span style="color:#f92672">&lt;-</span>  <span style="color:#a6e22e">read_html</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;https://keiba.yahoo.co.jp&#34;</span>,horse_url[l]))
                <span style="color:#a6e22e">Sys.sleep</span>(<span style="color:#ae81ff">0.5</span>)
                horse_name <span style="color:#f92672">&lt;-</span> horse1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//div[@id = &#39;dirTitName&#39;]/h1[@class = &#39;fntB&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                  <span style="color:#a6e22e">html_text</span>()
                horse <span style="color:#f92672">&lt;-</span> horse1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//div[@id = &#39;dirTitName&#39;]/ul&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                  <span style="color:#a6e22e">html_text</span>()
                race_result<span style="color:#f92672">$</span>colour[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(horse,<span style="color:#e6db74">&#34;毛色：.+&#34;</span>)) 
                race_result<span style="color:#f92672">$</span>owner[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(horse,<span style="color:#e6db74">&#34;馬主：.+&#34;</span>))
                race_result<span style="color:#f92672">$</span>farm[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(horse,<span style="color:#e6db74">&#34;生産者：.+&#34;</span>))
                race_result<span style="color:#f92672">$</span>locality[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(horse,<span style="color:#e6db74">&#34;産地：.+&#34;</span>))
                race_result<span style="color:#f92672">$</span>horse_birthday[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">str_extract_all</span>(horse,<span style="color:#e6db74">&#34;\\d+年\\d+月\\d+日&#34;</span>))
                race_result<span style="color:#f92672">$</span>father[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> horse1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//td[@class = &#39;bloodM&#39;][@rowspan = &#39;4&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_text</span>()
                race_result<span style="color:#f92672">$</span>mother[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> horse1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//td[@class = &#39;bloodF&#39;][@rowspan = &#39;4&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_text</span>()
              }
              , error <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(e){
                race_result<span style="color:#f92672">$</span>colour[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span> 
                race_result<span style="color:#f92672">$</span>owner[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                race_result<span style="color:#f92672">$</span>farm[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                race_result<span style="color:#f92672">$</span>locality[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                race_result<span style="color:#f92672">$</span>horse_birthday[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                race_result<span style="color:#f92672">$</span>father[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                race_result<span style="color:#f92672">$</span>mother[race_result<span style="color:#f92672">$</span>horse_name<span style="color:#f92672">==</span>horse_name] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
                }
            )
          }
          
          race_result<span style="color:#f92672">$</span>colour <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>colour,<span style="color:#e6db74">&#34;毛色：&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)
          race_result<span style="color:#f92672">$</span>owner <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>owner,<span style="color:#e6db74">&#34;馬主：&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)
          race_result<span style="color:#f92672">$</span>farm <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>farm,<span style="color:#e6db74">&#34;生産者：&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)
          race_result<span style="color:#f92672">$</span>locality <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>locality,<span style="color:#e6db74">&#34;産地：&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)
          <span style="color:#75715e">#race_result$horse_birthday &lt;- str_replace_all(race_result$horse_birthday,&#34;年&#34;,&#34;/&#34;)</span>
          <span style="color:#75715e">#race_result$horse_birthday &lt;- str_replace_all(race_result$horse_birthday,&#34;月&#34;,&#34;/&#34;)</span>
          <span style="color:#75715e">#race_result$horse_birthday &lt;- as.Date(race_result$horse_birthday)</span>
          
          race_result <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">arrange</span>(race_result,horse_number) <span style="color:#75715e"># arrange in order of precedence</span>
</code></pre></div><p>The next step is to go and drop the amount of money you have won up to that race. You can access this by following the link marked [Runoffs] (<a href="https://keiba.yahoo.co.jp/race/denma/1802010601/">https://keiba.yahoo.co.jp/race/denma/1802010601/</a>) on the race results page. This is where you will find the prize money and you will get it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">          yosou_url <span style="color:#f92672">&lt;-</span> race1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>) 
          yosou_url <span style="color:#f92672">&lt;-</span> yosou_url<span style="color:#a6e22e">[str_detect</span>(yosou_url, pattern<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;denma&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>]
          
          <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">length</span>(yosou_url)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>){
          yosou1 <span style="color:#f92672">&lt;-</span>  <span style="color:#a6e22e">read_html</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;https://keiba.yahoo.co.jp&#34;</span>,yosou_url)) 
          <span style="color:#a6e22e">Sys.sleep</span>(<span style="color:#ae81ff">2</span>)
          yosou <span style="color:#f92672">&lt;-</span> yosou1 <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">html_nodes</span>(xpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;//td[@class = &#39;txC&#39;]&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">as.character</span>()
          prize <span style="color:#f92672">&lt;-</span> yosou<span style="color:#a6e22e">[grepl</span>(<span style="color:#e6db74">&#34;万&#34;</span>,yosou)<span style="color:#f92672">==</span><span style="color:#66d9ef">TRUE</span>] <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">str_extract_all</span>(<span style="color:#e6db74">&#34;\\d+万&#34;</span>)
          prize <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">do.call</span>(<span style="color:#e6db74">&#34;data.frame&#34;</span>,prize)) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">as.character</span>()
          race_result<span style="color:#f92672">$</span>prize <span style="color:#f92672">&lt;-</span> prize
          race_result<span style="color:#f92672">$</span>prize <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_replace_all</span>(race_result<span style="color:#f92672">$</span>prize,<span style="color:#e6db74">&#34;万&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">as.numeric</span>()
          } else race_result<span style="color:#f92672">$</span>prize <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
</code></pre></div><p>We create a data frame called dataset to store the results of each race and store the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">          <span style="color:#75715e">## file storage</span>
          <span style="color:#a6e22e">if </span>(k <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> j <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
            dataset <span style="color:#f92672">&lt;-</span> race_result
          } else {
            dataset <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(dataset,race_result)
          }
        }else
        {
          <span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;We couldn&#39;t save it.&#34;</span>) 
        }
      }
    }
  }
  <span style="color:#a6e22e">beep</span>(<span style="color:#ae81ff">3</span>)
  <span style="color:#a6e22e">write.csv</span>(dataset,<span style="color:#e6db74">&#34;race_result2.csv&#34;</span>, row.names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
  
  <span style="color:#a6e22e">if </span>(year <span style="color:#f92672">==</span> <span style="color:#ae81ff">1994</span>){
    <span style="color:#a6e22e">dbWriteTable</span>(con, <span style="color:#e6db74">&#34;race_result&#34;</span>, dataset)
  } else {
    <span style="color:#a6e22e">dbWriteTable</span>(con, <span style="color:#e6db74">&#34;temp&#34;</span>, dataset)
    <span style="color:#a6e22e">dbSendQuery</span>(con, <span style="color:#e6db74">&#34;INSERT INTO race_result select * from temp&#34;</span>)
    <span style="color:#a6e22e">dbSendQuery</span>(con, <span style="color:#e6db74">&#34;DROP TABLE temp&#34;</span>)
  }
}
end.time <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.time</span>()
<span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">str_c</span>(<span style="color:#e6db74">&#34;処理時間は&#34;</span>,end.time<span style="color:#f92672">-</span>start.time,<span style="color:#e6db74">&#34;です。&#34;</span>))
<span style="color:#a6e22e">beep</span>(<span style="color:#ae81ff">5</span>)

<span style="color:#a6e22e">options</span>(warn <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)

<span style="color:#a6e22e">dbDisconnect</span>(con)
</code></pre></div><p>That&rsquo;s all. The data taken is as follows</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">head</span>(race_result)
</code></pre></div><pre><code>##   order frame_number horse_number   trainer passing_rank last_3F   time
## 1    10            1            1   田中 剛        09-09    39.0 1.14.3
## 2    16            1            2 天間 昭一        11-11    40.3 1.15.7
## 3    15            2            3 田中 清隆        14-14    39.4 1.15.1
## 4     9            2            4 中舘 英二        08-08    39.1 1.14.3
## 5    12            3            5 根本 康広        11-11    39.0 1.14.4
## 6     4            3            6 杉浦 宏昭        04-04    38.4 1.13.2
##      margin         horse_name horse_age horse_sex horse_weight
## 1    アタマ     サトノジョニー         3        牡          512
## 2 3 1/2馬身       ツギノイッテ         3        牡          464
## 3     3馬身           ギュウホ         3        牡          444
## 4 2 1/2馬身 セイウンメラビリア         3        牝          466
## 5      クビ サバイバルトリック         3        牝          450
## 6    アタマ       ステイホット         3        牝          474
##   horse_weight_change brinker      jockey jockey_weight jockey_weight_change
## 1                 +30       N   松岡 正海            56                    0
## 2                  +8       N 西田 雄一郎            56                    0
## 3                  +8       N   杉原 誠人            56                    0
## 4                 +10       N   村田 一誠            54                    0
## 5                  -2       N 野中 悠太郎            51                    0
## 6                  -2       N   大野 拓弥            54                    0
##    odds popularity  race_date race_course       race_name race_distance   type
## 1  40.3         9  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
## 2 340.9        16  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
## 3 283.1        14  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
## 4 299.7        15  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
## 5  26.7         8  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
## 6   2.4         1  2019-01-05        中山 サラ系3歳未勝利         1200m ダート
##   race_turn race_condition race_weather colour                           owner
## 1        右             良         晴れ   栗毛 株式会社 サトミホースカンパニー
## 2        右             良         晴れ 黒鹿毛                     西村 新一郎
## 3        右             良         晴れ   鹿毛           有限会社 ミルファーム
## 4        右             良         晴れ 青鹿毛                       西山 茂行
## 5        右             良         晴れ 黒鹿毛                       福田 光博
## 6        右             良         晴れ   栗毛                       小林 善一
##           farm   locality horse_birthday                 father
## 1   千代田牧場 新ひだか町  2016年1月29日         オルフェーヴル
## 2    織笠 時男     青森県  2016年4月17日 スクワートルスクワート
## 3    神垣 道弘 新ひだか町  2016年4月19日     ジャングルポケット
## 4  石郷岡 雅樹     新冠町  2016年4月21日     キンシャサノキセキ
## 5     原田牧場     日高町  2016年4月30日       リーチザクラウン
## 6 社台ファーム     千歳市  2016年3月13日     キャプテントゥーレ
##               mother prize
## 1 スパークルジュエル     0
## 2   エプソムアイリス     0
## 3     デライトシーン     0
## 4     ドリームシップ     0
## 5   フリーダムガール   180
## 6     ステイアライヴ   455
</code></pre>
          </div>

          






<div class="article-tags">
  
  <a class="badge badge-light" href="../../../en/tag/r/">R</a>
  
  <a class="badge badge-light" href="../../../en/tag/web_scraping/">Web_scraping</a>
  
  <a class="badge badge-light" href="../../../en/tag/preprocessing/">preprocessing</a>
  
  <a class="badge badge-light" href="../../../en/tag/sql/">SQL</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=../../../en/post/post11/&amp;text=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/en/post/post11/&amp;t=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29&amp;body=/en/post/post11/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=../../../en/post/post11/&amp;title=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29%20/en/post/post11/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=../../../en/post/post11/&amp;title=Scraping%20past%20race%20results%20on%20yahoo%20horse%20racing%20on%20rvest%20%28for%20the%20second%20time%29" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="../../../"><img class="avatar mr-3 avatar-circle" src="../../../en/author/ayato-ashihara/avatar_hu77c0c0affdebd3b9cbda9c39412092b5_245163_270x270_fill_q90_lanczos_center.jpg" alt="Ayato Ashihara"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="../../../">Ayato Ashihara</a></h5>
      <h6 class="card-subtitle">company employee</h6>
      
      
        










  
  
  
    
  



  
  
  
  
  
  
  
    
  



  <p class="card-text author-dynamic">Started work in 2018; currently in year 8 of professional career. Born on January 19, 1994 and currently 32 years old.</p>


      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="../../../en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.facebook.com/ASSIY" target="_blank" rel="noopener">
        <i class="fab fa-facebook"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/AyatoAshihara/myblog_multi" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/%E5%BD%A9%E4%BA%BA-%E8%91%A6%E5%8E%9F-9391b7143/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "ayatoashihara-github-io-myblog-multi" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="../../../en/post/post12/" rel="next">Obtaining satellite image data with the Google Earth Engine API and do nowcasting on business conditions</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="../../../en/post/post2/" rel="prev">I built the Asset Allocation Model in R.</a>
  </div>
  
</div>

</div>





  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="../../../en/post/post22/">Get macro panel data from OECD.org via API</a></li>
      
      <li><a href="../../../en/post/post21/">Rcpp to speed up data handling (using Tick data processing as an example)</a></li>
      
      <li><a href="../../../en/post/post20/">Automatically cropping the background of a horse body photo with Pytorch&#39;s Pre-trained model</a></li>
      
      <li><a href="../../../en/post/post18/">I predicted the standings based on horse photos using CNN.</a></li>
      
      <li><a href="../../../en/post/post16/">Predicting Horse Racing Results Using LightGBM</a></li>
      
    </ul>
  </div>
  





        </div>
      </article>
    </main>

  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.0/mermaid.min.js" integrity="sha512-ja+hSBi4JDtjSqc4LTBsSwuBT3tdZ3oKYKd07lTVYmCnTCor56AnRql00ssqnTOR9Ss4gOP/ROGB3SfcJnZkeg==" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/sql.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/cpp.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/en/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://ayatoashihara-github-io-myblog-multi.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
      
    
    
    
    <script src="../../../js/wowchemy.min.2a3f95be2bc4762ba1847fb5d7a28317.js"></script>

    


  
  
  <div class="container">
    <footer class="site-footer">
  

  
   
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "show");
  });
  </script>
  <script src="../../../js/codefolding.js"></script>


  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy</a>  —
    the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">
    open source</a> website builder that empowers creators.
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
