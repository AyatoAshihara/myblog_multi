<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  
  
  <meta name="generator" content="Wowchemy 4.8.0 for Hugo">
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Ayato Ashihara">

  
  
  
    
  
  <meta name="description" content="We had an in-house workshop and spent the holidays locked up in the Library of Congress, fishing for prior research, which allowed us to build a subtle asset allocation model.">

  
  <link rel="alternate" hreflang="ja" href="../../../post/post2/">
  
  <link rel="alternate" hreflang="en-us" href="../../../en/post/post2/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="../../../js/mathjax-config.js"></script>
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js" integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="../../../css/wowchemy.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140804055-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-140804055-1', { 'anonymize_ip': true });

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="../../../en/index.webmanifest">
  <link rel="icon" type="image/png" href="../../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="../../../en/post/post2/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@vdjgdkhvskcndj">
  <meta property="twitter:creator" content="@vdjgdkhvskcndj">
  
  <meta property="og:site_name" content="京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:url" content="/en/post/post2/">
  <meta property="og:title" content="I built the Asset Allocation Model in R. | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:description" content="We had an in-house workshop and spent the holidays locked up in the Library of Congress, fishing for prior research, which allowed us to build a subtle asset allocation model."><meta property="og:image" content="/en/post/post2/featured.png">
  <meta property="twitter:image" content="/en/post/post2/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-02-17T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-03-03T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/en/post/post2/"
  },
  "headline": "I built the Asset Allocation Model in R.",
  
  "image": [
    "/en/post/post2/featured.png"
  ],
  
  "datePublished": "2019-02-17T00:00:00Z",
  "dateModified": "2019-03-03T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Ayato Ashihara"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "京都の電子部品メーカーで働く社会人が研究に没頭するブログ",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "We had an in-house workshop and spent the holidays locked up in the Library of Congress, fishing for prior research, which allowed us to build a subtle asset allocation model."
}
</script>

  

  


  
  
  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://www.cookiesandyou.com"
      }
    })});
  </script>



  





  <title>I built the Asset Allocation Model in R. | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.wcDarkLightEnabled = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="../../../js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="../../../en">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="../../../en">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="../../../en/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../../en/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      <li class="nav-item dropdown i18n-dropdown">
        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-globe mr-1" aria-hidden="true"></i><span class="d-none d-lg-inline">English</span></a>
        <div class="dropdown-menu">
          <div class="dropdown-item dropdown-item-active">
            <span>English</span>
          </div>
          
          <a class="dropdown-item" href="../../../post/post2/">
            <span>日本語</span>
          </a>
          
        </div>
      </li>
      

    </ul>

  </div>
</nav>



  <div class="container-fluid docs">
  <div class="row flex-xl-nowrap">

    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-minimum-variance-portfolio">1. Minimum Variance Portfolio</a></li>
        <li><a href="#2-how-to-predict-the-variance-covariance-matrix">2. How to predict the variance-covariance matrix</a>
          <ul>
            <li><a href="#a-constant-conditional-correlation-ccc-model">A. Constant conditional correlation (CCC) model</a></li>
            <li><a href="#b-dynamic-conditional-correlation-dcc-model">B. Dynamic Conditional Correlation (DCC) model</a></li>
            <li><a href="#c-dynamic-equicorrelation-deco-model">C. Dynamic Equicorrelation (DECO) model</a></li>
          </ul>
        </li>
        <li><a href="#3-collection-of-data-for-testing">3. Collection of data for testing</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
    </div>

    <main class="col-12 col-md-0 col-xl-10 py-md-3 pl-md-5 docs-content" role="main">
      <article class="article">

        




















  
  
    
  


<div class="article-container pt-3">
  <h1>I built the Asset Allocation Model in R.</h1>

  

  

<div id="code-folding-buttons" class="dropdown btn-group pull-right">
  <a class="btn btn-light btn-sm dropdown-toggle" href="#" role="button" id="allCodeToggleButton"
     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Code
  </a>
  <div class="dropdown-menu" aria-labelledby="allCodeToggleButton">
    <a id="rmd-show-all-code" class="dropdown-item small" href="#">Show all</a>
    <a id="rmd-hide-all-code" class="dropdown-item small" href="#">Hide all</a>
  </div>
</div>



  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Mar 3, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="../../../en/post/post2/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="../../../en/category/work-related/">work-related</a></span>
  

</div>

  














</div>


<div class="article-header container featured-image-wrapper mt-4 mb-4" style="max-width: 1200px; max-height: 857px;">
  <div style="position: relative">
    <img src="../../../en/post/post2/featured_hub4b9ae3f4f01909acf9fb74ca6fbac7b_36204_1200x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



        <div class="article-container">

          <div class="article-style">
            <p>Hi. I attended a workshop on asset allocation at my place of work, so I&rsquo;d like to run some simulations here, even though this field is completely outside my expertise. In this article, I would like to do an exercise on how to estimate the variance-covariance matrix (predictions) of a minimum variance portfolio as the base portfolio, referring to previous studies. The reference research is in the following paper (in the Journal of Operations Research).</p>
<p><a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2947643" target="_blank" rel="noopener">Asset Allocation with Correlation: A Composite Trade-Off</a></p>
<h2 id="1-minimum-variance-portfolio">1. Minimum Variance Portfolio</h2>
<p>I won&rsquo;t go into a detailed explanation of the minimum variance portfolio here, but it is a portfolio that calculates the average return and variance of each asset (domestic stocks, foreign stocks, domestic bonds, foreign bonds, and alternatives), plots them on a quadratic plane of average return vertical and variance horizontal axes, calculates the range of possible investments, and then calculates the smallest variance in the set (see the chart below).</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Minimum_variance_flontier_of_MPT.svg/1280px-Minimum_variance_flontier_of_MPT.svg.png" alt="minimum variance portfolio"></p>
<p>In an earlier study, Carroll et. al. (2017), the following is stated</p>
<blockquote>
<p>this paper focusses on minimum-variance portfolios requiring only estimates of asset covariance, hence bypassing the well-known problem of estimation error in forecasting expected asset returns.</p>
</blockquote>
<p>Even at present, it is difficult to estimate expected returns, and a minimum variance portfolio, which does not require it, is a useful and practical technique. The objective function of a minimum variance portfolio is, as the name implies, <strong>to minimize diversification</strong>. If we now denote the vector of collected returns for each asset by <code>\(r\)</code>, the holding weight of each asset by <code>\(\theta\)</code>, and the portfolio return by <code>\(R_{p}\)</code>, then the overall portfolio variance <code>\(var(R_{p})\)</code> can be written as follows.</p>
<p>$$
var(R_{p}) = var(r^{T}\theta) = E( (r^{T}\theta)(r^{T}\theta)^{T}) = \theta^{T}\Sigma\theta
$$</p>
<p>where <code>\(Sigma\)</code> is the variance-covariance matrix of <code>\(r\)</code>. Thus, the minimization problem is as follows</p>
<p>$$
\min_{\theta}(\theta^{T}\Sigma\theta) \<br>
s.t 1^{T}\theta = 1
$$</p>
<p>Here we have added full investment as a constraint. Let&rsquo;s use the Lagrangian to solve this problem. The Lagrange function <code>\(L\)</code> is as follows</p>
<p>$$
L = \theta^{T}\Sigma\theta + \lambda(1^{T}\theta - 1)
$$</p>
<p>The first condition is</p>
<p>$$
\displaystyle\frac{\partial L}{\partial \theta} = 2\Sigma\theta + 1\lambda = 0 \<br>
\displaystyle \frac{\partial L}{\partial \lambda} = 1^{T} \theta = 1
$$</p>
<p>Solving the first equation for <code>\(\theta\)</code>, we find that</p>
<p>$$
\theta = \Sigma^{-1}1\lambda^{*}
$$</p>
<p>where <code>\(\lambda^{*}=-1/2\lambda\)</code>. Substitute this into the second formula and solve for <code>\(\lambda^{*}\)</code></p>
<p>$$
1^{T}\Sigma1\lambda^{<em>} = 1 \<br>
\displaystyle \lambda^{</em>} = \frac{1}{1^{T}\Sigma^{-1}1}
$$</p>
<p>Since <code>\(\theta = \Sigma^{-1}1\lambda^{*}\)</code>, erasing <code>\(\lambda^{*}\)</code> will cause it to be</p>
<p>$$
\displaystyle \theta_{gmv} = \frac{\Sigma^{-1}1}{1^{T}\Sigma^{-1}1}
$$</p>
<p>and we can now find the optimal weight. For now, I&rsquo;ll implement this in R.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gmv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(r_dat,r_cov){
  <span style="color:#a6e22e">library</span>(MASS)
  i <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">NCOL</span>(r_dat),<span style="color:#ae81ff">1</span>)
  r_weight <span style="color:#f92672">&lt;-</span> (<span style="color:#a6e22e">ginv</span>(r_cov)<span style="color:#f92672">%*%</span>i)<span style="color:#f92672">/</span><span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">t</span>(i)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(r_cov)<span style="color:#f92672">%*%</span>i)
  wr_dat <span style="color:#f92672">&lt;-</span> r_dat<span style="color:#f92672">*</span><span style="color:#a6e22e">as.numeric</span>(r_weight)
  portfolio <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(wr_dat,<span style="color:#ae81ff">1</span>,sum)
  pr_dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(wr_dat,portfolio)
  sd <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sd</span>(portfolio)
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(r_weight,pr_dat,sd)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;weight&#34;</span>,<span style="color:#e6db74">&#34;return&#34;</span>,<span style="color:#e6db74">&#34;portfolio risk&#34;</span>) 
  <span style="color:#a6e22e">return</span>(result)
}

nlgmv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(r_dat,r_cov){
  qp.out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">solve.QP</span>(Dmat<span style="color:#f92672">=</span>r_cov,dvec<span style="color:#f92672">=</span><span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">NCOL</span>(r_dat)),Amat<span style="color:#f92672">=</span><span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">NCOL</span>(r_dat)),<span style="color:#a6e22e">diag</span>(<span style="color:#a6e22e">NCOL</span>(r_dat))),
           bvec<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">NCOL</span>(r_dat))),meq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
  r_weight <span style="color:#f92672">&lt;-</span> qp.out<span style="color:#f92672">$</span>solution
  wr_dat <span style="color:#f92672">&lt;-</span> r_dat<span style="color:#f92672">*</span>r_weight
  portfolio <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(wr_dat,<span style="color:#ae81ff">1</span>,sum)
  pr_dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(wr_dat,portfolio)
  sd <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sd</span>(portfolio)
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(r_weight,pr_dat,sd)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;weight&#34;</span>,<span style="color:#e6db74">&#34;return&#34;</span>,<span style="color:#e6db74">&#34;portfolio risk&#34;</span>)
  <span style="color:#a6e22e">return</span>(result)
}
</code></pre></div><p>The input is a return and variance-covariance matrix for each asset. The output is the weight, return and risk. <code>nlgmv</code> is a short-sale constrained version of the minimum variance portfolio. Since we cannot get an analytical solution, we are trying to get a numerical solution.</p>
<h2 id="2-how-to-predict-the-variance-covariance-matrix">2. How to predict the variance-covariance matrix</h2>
<p>We have found the formula for the minimum variance portfolio. The next step is to analyze how to find the input, the variance-covariance matrix. I think the most primitive approach would be the historical approach of finding the covariance matrix for a sample of return data available before that point in time, and then finding the minimum variance portfolio by fixing the value of the covariance matrix (i.e., the weights are also fixed). However, since this is just using historical averages for future projections, I&rsquo;m sure there will be all sorts of problems. As a non-specialist, I can think of a situation where the return on asset A declined significantly the day before, but the variance of this asset is expected to remain high tomorrow, and the effect of yesterday is diluted by using the average. And I feel that not changing the weights from the start would also move away from the optimal point over time. However, there seems to be some trial and error in this area as to how to estimate it then. Also, in Carroll et. al. (2017), it is stated that,</p>
<blockquote>
<p>The estimation of covariance matrices for portfolios with a large number of assets still remains a fundamental challenge in portfolio optimization.</p>
</blockquote>
<p>The estimates in this paper are based on the following models. All of them are unique in that the variance-covariance matrix is time-varying.</p>
<h3 id="a-constant-conditional-correlation-ccc-model">A. Constant conditional correlation (CCC) model</h3>
<p>The original paper is <a href="https://www.jstor.org/stable/2109358?read-now=1&amp;seq=3#page_scan_tab_contents" target="_blank" rel="noopener">here</a>.</p>
<p>First, from the relationship between the variance-covariance matrix and the correlation matrix, we have <code>\(\Sigma_{t} = D_{t}R_{t}D_{t}\)</code>, where <code>\(R_{t}\)</code> is the variance-covariance matrix and <code>\(D_{t}\)</code> is <code>\(diag(\sigma_{1,t},...,\sigma_{N,t})\)</code>, a matrix whose diagonal components are the standard deviation of each asset in <code>\(tt\)</code> period. From here, we estimate <code>\(D_{t}\)</code> and <code>\(R_{t}\)</code> separately. First, <code>\(D_{t}\)</code> is estimated using the following multivariate GARCH model (1,1).</p>
<p>$$
r_{t} = \mu + u_{t} \<br>
u_{t} = \sigma_{t}\epsilon \<br>
\sigma_{t}^{2} = \alpha_{0} + \alpha_{1}u_{t-1}^{2} + \alpha_{2}\sigma_{t-1}^{2} \<br>
\epsilon_{t} = NID(0,1) \<br>
E(u_{t}|u_{t-1}) = 0
$$ 
where <code>\(\mu\)</code> is the sample mean of the returns. <code>\(\alpha_{i}\)</code> is the parameter to be estimated. Since we are estimating <code>\(D_{t}\)</code> with GARCH, we can say that we are modeling a relationship where the distribution of returns follows a thicker base distribution than the normal distribution and where the change in returns is not constant but depends on the variance of the previous day. We can say that we have estimated <code>\(D_{t}\)</code> in this way. The next step in the estimation of <code>\(R_{t}\)</code> is to take a historical approach to the estimation of <code>\(R_{t}\)</code>, in which the returns are sampled. In other words, <code>\(R_{t}\)</code> is a constant. Thus, we are making the assumption that the magnitude of return variation varies with time, but the relative relationship of each asset is invariant.</p>
<h3 id="b-dynamic-conditional-correlation-dcc-model">B. Dynamic Conditional Correlation (DCC) model</h3>
<p>The original paper is <a href="http://www.cass.city.ac.uk/__data/assets/pdf_file/0003/78960/Week7Engle_2002.pdf" target="_blank" rel="noopener">here</a>。</p>
<p>こちらのモデルでは、$D_{t}$を求めるところまでは①と同じですが、[$R_{t}$の求め方が異なっており、ARMA(1,1)を用いて推計します。相関行列はやはり定数ではないということで、$tex:t$期までに利用可能なリターンを用いて推計をかけようということになっています。このモデルの相関行列$R_{t}$は、</p>
<p>This model is the same as (1) up to the point of finding <code>\(D_{t}\)</code>, but the way of finding <code>\(R_{t}\)</code> is different, and we use <code>ARMA(1,1)</code> to estimate it. Since the correlation matrix is still not a constant, we are going to use the available returns up to the <code>\(t\)</code> period to make the estimate. The correlation matrix <code>\(R_{t}\)</code> in this model is</p>
<p>$$
R_{t} = diag(Q_{t})^{-1/2}Q_{t}diag(Q_{t})^{-1/2}
$$</p>
<p>where <code>\(Q_{t}\)</code> is a conditional variance-covariance matrix in the <code>\(t\)</code> period, formulated as follows,</p>
<p>$$
Q_{t} = \bar{Q}(1-a-b) + adiag(Q_{t-1})^{1/2}\epsilon_{i,t-1}\epsilon_{i,t-1}diag(Q_{t-1})^{1/2} + bQ_{t-1}
$$</p>
<p>where <code>\(\bar{Q}\)</code> is the variance-covariance matrix calculated in a historical way and <code>\(a,b\)</code> is the parameter. This method differs from the previous one in that it assumes that not only does the magnitude of return variation vary with time, but also the relative relationship of each asset changes over time. Since we have observed some events in which the returns of all assets fall and the correlation of each asset becomes positive during a financial crisis, this formulation may be attractive.</p>
<h3 id="c-dynamic-equicorrelation-deco-model">C. Dynamic Equicorrelation (DECO) model</h3>
<p>The original paper is <a href="https://faculty.chicagobooth.edu/bryan.kelly/research/pdf/deco.pdf" target="_blank" rel="noopener">here</a>。</p>
<p>I haven&rsquo;t read this paper exactly yet, but from the definition of the correlation matrix <code>\(R_{t}\)</code> becomes</p>
<p>$$
R_{t} = (1-\rho_{t})I_{N} + \rho_{t}1
$$</p>
<p>Here, <code>\(\rho_{t}\)</code> is a scalar and a coefficient for the degree of equicorrelation, and I understand that equicorrelation is an average pair-wise correlation. In other words, if there are no missing values, it&rsquo;s no different than a normal correlation. However, it seems to be a good estimator in that respect, because as assets increase, such problems need to be addressed. We can calculate <code>\(\rho_{t}\)</code> as follows.</p>
<p>$$
\displaystyle \rho_{t} = \frac{1}{N(N-1)}(\iota^{T}R_{t}^{DCC}\iota - N) = \frac{2}{N(N-1)}\sum_{i&gt;j}\frac{q_{ij,t}}{\sqrt{q_{ii,t} q_{jj,t}}}
$$</p>
<p>where <code>\(\iota\)</code> is an <code>\(N×1\)</code> vector with all elements being 1. And <code>\(q_{ij,t}\)</code> is the <code>\(i,j\)</code> element of <code>\(Q_{t}\)</code>.</p>
<p>Now that we&rsquo;ve modeled the variance-covariance matrix, we&rsquo;ll implement it so far in <code>R</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">carroll <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(r_dat,FLG){
  
  <span style="color:#a6e22e">library</span>(rmgarch)
  
  <span style="color:#a6e22e">if</span>(FLG <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;benchmark&#34;</span>){
    H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cov</span>(r_dat)
  }else{
    <span style="color:#75715e">#1. define variables</span>
    N <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NCOL</span>(r_dat) <span style="color:#75715e"># the number of assets</span>
    
    <span style="color:#75715e">#2. estimate covariance matrix</span>
    basic_garch <span style="color:#f92672">=</span> <span style="color:#a6e22e">ugarchspec</span>(mean.model <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(armaOrder <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>),include.mean<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>), variance.model <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(garchOrder <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), model <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sGARCH&#39;</span>), distribution.model <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;norm&#39;</span>)
    multi_garch <span style="color:#f92672">=</span> <span style="color:#a6e22e">multispec</span>(<span style="color:#a6e22e">replicate</span>(N, basic_garch))
    dcc_set <span style="color:#f92672">=</span> <span style="color:#a6e22e">dccspec</span>(uspec <span style="color:#f92672">=</span> multi_garch, dccOrder <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), distribution <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mvnorm&#34;</span>,model <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DCC&#34;</span>)
    fit_dcc_garch <span style="color:#f92672">=</span> <span style="color:#a6e22e">dccfit</span>(dcc_set, data <span style="color:#f92672">=</span> r_dat, fit.control <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(eval.se <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
    forecast_dcc_garch <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dccforecast</span>(fit_dcc_garch)
    <span style="color:#a6e22e">if </span>(FLG <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;CCC&#34;</span>){
      <span style="color:#75715e">#Constant conditional correlation (CCC) model</span>
      D <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sigma</span>(forecast_dcc_garch)
      R_ccc <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cor</span>(r_dat)
      H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(D[,,<span style="color:#ae81ff">1</span>])<span style="color:#f92672">%*%</span>R_ccc<span style="color:#f92672">%*%</span><span style="color:#a6e22e">diag</span>(D[,,<span style="color:#ae81ff">1</span>])
      <span style="color:#a6e22e">colnames</span>(H) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(r_dat)
      <span style="color:#a6e22e">rownames</span>(H) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(r_dat)
    }
    else{
      <span style="color:#75715e">#Dynamic Conditional Correlation (DCC) model</span>
      H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(<span style="color:#a6e22e">rcov</span>(forecast_dcc_garch)[[1]][,,<span style="color:#ae81ff">1</span>])
      <span style="color:#a6e22e">if </span>(FLG <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;DECO&#34;</span>){
        <span style="color:#75715e">#Dynamic Equicorrelation (DECO) model</span>
        one <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span>,N,N)
        iota <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>,N)
        Q_dcc <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rcor</span>(forecast_dcc_garch,type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Q&#34;</span>)[[1]][,,<span style="color:#ae81ff">1</span>]
        rho <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.vector</span>((N<span style="color:#f92672">*</span>(N<span style="color:#ae81ff">-1</span>))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span>(<span style="color:#a6e22e">t</span>(iota)<span style="color:#f92672">%*%</span>Q_dcc<span style="color:#f92672">%*%</span>iota<span style="color:#f92672">-</span>N))
        D <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sigma</span>(forecast_dcc_garch)
        R_deco <span style="color:#f92672">&lt;-</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>rho)<span style="color:#f92672">*</span><span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,N,N) <span style="color:#f92672">+</span> rho<span style="color:#f92672">*</span>one
        H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(D[,,<span style="color:#ae81ff">1</span>])<span style="color:#f92672">%*%</span>R_deco<span style="color:#f92672">%*%</span><span style="color:#a6e22e">diag</span>(D[,,<span style="color:#ae81ff">1</span>])
        <span style="color:#a6e22e">colnames</span>(H) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(r_dat)
        <span style="color:#a6e22e">rownames</span>(H) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(r_dat)
      }
    }
  }
  <span style="color:#a6e22e">return</span>(H)
}
</code></pre></div><p>I shouldn&rsquo;t normally use the package, but since it&rsquo;s an exercise today I&rsquo;m only going to pursue the results of the estimates, and I&rsquo;ll be writing a post about GARCH in the next week or so.
Now we&rsquo;re ready to go. We can now put the return data into this function to calculate the variance-covariance matrix and use it to calculate the minimum variance portfolio.</p>
<h2 id="3-collection-of-data-for-testing">3. Collection of data for testing</h2>
<p>The data was based on the following article.</p>
<p>(Introduction to Asset Allocation)[https://www.r-bloggers.com/introduction-to-asset-allocation/]</p>
<p>We used NAV data for an ETF (iShares) that is linked to the following index</p>
<ul>
<li>S&amp;P500</li>
<li>NASDAQ100</li>
<li>MSCI Emerging Markets</li>
<li>Russell 2000</li>
<li>MSCI EAFE</li>
<li>US 20 Year Treasury(the Barclays Capital 20+ Year Treasury Index)</li>
<li>U.S. Real Estate(the Dow Jones US Real Estate Index)</li>
<li>gold bullion market</li>
</ul>
<p>The first step is to collect data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(quantmod)

<span style="color:#75715e">#**************************</span>
<span style="color:#75715e"># ★8 ASSETS SIMULATION</span>
<span style="color:#75715e"># SPY - S&amp;P 500 </span>
<span style="color:#75715e"># QQQ - Nasdaq 100</span>
<span style="color:#75715e"># EEM - Emerging Markets</span>
<span style="color:#75715e"># IWM - Russell 2000</span>
<span style="color:#75715e"># EFA - EAFE</span>
<span style="color:#75715e"># TLT - 20 Year Treasury</span>
<span style="color:#75715e"># IYR - U.S. Real Estate</span>
<span style="color:#75715e"># GLD - Gold</span>
<span style="color:#75715e">#**************************</span>

<span style="color:#75715e"># load historical prices from Yahoo Finance</span>
symbol.names <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;S&amp;P 500&#34;</span>,<span style="color:#e6db74">&#34;Nasdaq 100&#34;</span>,<span style="color:#e6db74">&#34;Emerging Markets&#34;</span>,<span style="color:#e6db74">&#34;Russell 2000&#34;</span>,<span style="color:#e6db74">&#34;EAFE&#34;</span>,<span style="color:#e6db74">&#34;20 Year Treasury&#34;</span>,<span style="color:#e6db74">&#34;U.S. Real Estate&#34;</span>,<span style="color:#e6db74">&#34;Gold&#34;</span>)
symbols <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;SPY&#34;</span>,<span style="color:#e6db74">&#34;QQQ&#34;</span>,<span style="color:#e6db74">&#34;EEM&#34;</span>,<span style="color:#e6db74">&#34;IWM&#34;</span>,<span style="color:#e6db74">&#34;EFA&#34;</span>,<span style="color:#e6db74">&#34;TLT&#34;</span>,<span style="color:#e6db74">&#34;IYR&#34;</span>,<span style="color:#e6db74">&#34;GLD&#34;</span>)
<span style="color:#a6e22e">getSymbols</span>(symbols, from <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1980-01-01&#39;</span>, auto.assign <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e">#gn dates for all symbols &amp; convert to monthly</span>
hist.prices <span style="color:#f92672">=</span> <span style="color:#a6e22e">merge</span>(SPY,QQQ,EEM,IWM,EFA,TLT,IYR,GLD)
month.ends <span style="color:#f92672">=</span> <span style="color:#a6e22e">endpoints</span>(hist.prices, <span style="color:#e6db74">&#39;day&#39;</span>)
hist.prices <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cl</span>(hist.prices)[month.ends, ]
<span style="color:#a6e22e">colnames</span>(hist.prices) <span style="color:#f92672">=</span> symbols

<span style="color:#75715e"># remove any missing data</span>
hist.prices <span style="color:#f92672">=</span> <span style="color:#a6e22e">na.omit</span>(hist.prices[<span style="color:#e6db74">&#39;1995::&#39;</span>])

<span style="color:#75715e"># compute simple returns</span>
hist.returns <span style="color:#f92672">=</span> <span style="color:#a6e22e">na.omit</span>( <span style="color:#a6e22e">ROC</span>(hist.prices, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;discrete&#39;</span>) )

<span style="color:#75715e"># compute historical returns, risk, and correlation</span>
ia <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>()
ia<span style="color:#f92672">$</span>expected.return <span style="color:#f92672">=</span> <span style="color:#a6e22e">apply</span>(hist.returns, <span style="color:#ae81ff">2</span>, mean, na.rm <span style="color:#f92672">=</span> T)
ia<span style="color:#f92672">$</span>risk <span style="color:#f92672">=</span> <span style="color:#a6e22e">apply</span>(hist.returns, <span style="color:#ae81ff">2</span>, sd, na.rm <span style="color:#f92672">=</span> T)
ia<span style="color:#f92672">$</span>correlation <span style="color:#f92672">=</span> <span style="color:#a6e22e">cor</span>(hist.returns, use <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;complete.obs&#39;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;pearson&#39;</span>)

ia<span style="color:#f92672">$</span>symbols <span style="color:#f92672">=</span> symbols
ia<span style="color:#f92672">$</span>symbol.names <span style="color:#f92672">=</span> symbol.names
ia<span style="color:#f92672">$</span>n <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(symbols)
ia<span style="color:#f92672">$</span>hist.returns <span style="color:#f92672">=</span> hist.returns

<span style="color:#75715e"># convert to annual, year = 12 months</span>
annual.factor <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
ia<span style="color:#f92672">$</span>expected.return <span style="color:#f92672">=</span> annual.factor <span style="color:#f92672">*</span> ia<span style="color:#f92672">$</span>expected.return
ia<span style="color:#f92672">$</span>risk <span style="color:#f92672">=</span> <span style="color:#a6e22e">sqrt</span>(annual.factor) <span style="color:#f92672">*</span> ia<span style="color:#f92672">$</span>risk

<span style="color:#a6e22e">rm</span>(SPY,QQQ,EEM,IWM,EFA,TLT,IYR,GLD)
</code></pre></div><p>Here&rsquo;s how the returns are plotted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">PerformanceAnalytics<span style="color:#f92672">::</span><span style="color:#a6e22e">charts.PerformanceSummary</span>(hist.returns, main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Performance summary&#34;</span>)
</code></pre></div><p><img src="../../../en/post/post2/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Next, we&rsquo;ll code the backtest. We&rsquo;ll publish the code all at once.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># BACK TEST</span>
backtest <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(r_dat,FLG,start_date,span,learning_term,port){
  <span style="color:#75715e">#-----------------------------------------</span>
  <span style="color:#75715e"># BACKTEST</span>
  <span style="color:#75715e"># r_dat - return data(xts object) </span>
  <span style="color:#75715e"># FLG - flag(CCC,DCC,DECO)</span>
  <span style="color:#75715e"># start_date - start date for backtest</span>
  <span style="color:#75715e"># span - rebalance frequency</span>
  <span style="color:#75715e"># learning_term - learning term (days)</span>
  <span style="color:#75715e"># port - method of portfolio optimization</span>
  <span style="color:#75715e">#-----------------------------------------</span>
  
  <span style="color:#a6e22e">library</span>(stringi)

  initial_dat <span style="color:#f92672">&lt;-</span> r_dat<span style="color:#a6e22e">[stri_c</span>(<span style="color:#a6e22e">as.Date</span>(start_date)<span style="color:#f92672">-</span>learning_term,<span style="color:#e6db74">&#34;::&#34;</span>,<span style="color:#a6e22e">as.Date</span>(start_date))]
  <span style="color:#a6e22e">for </span>(i in <span style="color:#a6e22e">NROW</span>(initial_dat)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(r_dat)) {
    <span style="color:#a6e22e">if </span>(i <span style="color:#f92672">==</span> <span style="color:#a6e22e">NROW</span>(initial_dat)){
      H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">carroll</span>(initial_dat[1<span style="color:#f92672">:</span>(<span style="color:#a6e22e">NROW</span>(initial_dat)<span style="color:#ae81ff">-1</span>),],FLG)
      <span style="color:#a6e22e">if </span>(port <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nlgmv&#34;</span>){
        result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">nlgmv</span>(initial_dat,H)
      }else <span style="color:#a6e22e">if </span>(port <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;risk parity&#34;</span>){
        result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">risk_parity</span>(initial_dat,H)
      }
      weight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(result<span style="color:#f92672">$</span>weight)
      <span style="color:#a6e22e">colnames</span>(weight) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(initial_dat)
      p_return <span style="color:#f92672">&lt;-</span> initial_dat<span style="color:#a6e22e">[NROW</span>(initial_dat),]<span style="color:#f92672">*</span>result<span style="color:#f92672">$</span>weight
    } else {
      <span style="color:#a6e22e">if </span>(i <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">endpoints</span>(r_dat,span)){
        H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">carroll</span>(test_dat[1<span style="color:#f92672">:</span>(<span style="color:#a6e22e">NROW</span>(test_dat)<span style="color:#ae81ff">-1</span>),],FLG)
        <span style="color:#a6e22e">if </span>(port <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nlgmv&#34;</span>){
          result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">nlgmv</span>(test_dat,H)
        }else <span style="color:#a6e22e">if </span>(port <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;risk parity&#34;</span>){
          result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">risk_parity</span>(test_dat,H)
        }
        
      }
      weight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(weight,<span style="color:#a6e22e">t</span>(result<span style="color:#f92672">$</span>weight))
      p_return <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(p_return,test_dat<span style="color:#a6e22e">[NROW</span>(test_dat),]<span style="color:#f92672">*</span>result<span style="color:#f92672">$</span>weight)
    }
    <span style="color:#a6e22e">if </span>(i <span style="color:#f92672">!=</span> <span style="color:#a6e22e">NROW</span>(r_dat)){
      term <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">stri_c</span>(<span style="color:#a6e22e">index</span>(r_dat[i<span style="color:#ae81ff">+1</span>,])<span style="color:#f92672">-</span>learning_term,<span style="color:#e6db74">&#34;::&#34;</span>,<span style="color:#a6e22e">index</span>(r_dat[i<span style="color:#ae81ff">+1</span>,])) 
      test_dat <span style="color:#f92672">&lt;-</span> r_dat[term]
    }
  }
  p_return<span style="color:#f92672">$</span>portfolio <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xts</span>(<span style="color:#a6e22e">apply</span>(p_return,<span style="color:#ae81ff">1</span>,sum),order.by <span style="color:#f92672">=</span> <span style="color:#a6e22e">index</span>(p_return))
  weight.xts <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xts</span>(weight,order.by <span style="color:#f92672">=</span> <span style="color:#a6e22e">index</span>(p_return))

  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(p_return,weight.xts)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;return&#34;</span>,<span style="color:#e6db74">&#34;weight&#34;</span>)
  <span style="color:#a6e22e">return</span>(result)
}

CCC <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;CCC&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
DCC <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;DCC&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
DECO <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;DECO&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
benchmark <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;benchmark&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)

result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">merge</span>(CCC<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,DCC<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,DECO<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,benchmark<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio)
<span style="color:#a6e22e">colnames</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;CCC&#34;</span>,<span style="color:#e6db74">&#34;DCC&#34;</span>,<span style="color:#e6db74">&#34;DECO&#34;</span>,<span style="color:#e6db74">&#34;benchmark&#34;</span>)
</code></pre></div><p>Here&rsquo;s a graph of the calculation results.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">PerformanceAnalytics<span style="color:#f92672">::</span><span style="color:#a6e22e">charts.PerformanceSummary</span>(result,main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BACKTEST&#34;</span>)
</code></pre></div><p><img src="../../../en/post/post2/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>I did not use the minimum variance portfolio defined above because I imposed a short sale constraint. Apparently it&rsquo;s difficult to solve analytically with this alone, so I&rsquo;m going to solve numerically. I used a weekly rebalancing period, so it took me a while to calculate the results on my own PC, but I was able to calculate the results.</p>
<p>Since Lehman, it appears to have outperformed the benchmark equal weighted portfolio. In particular, DECO is looking good. I would like to rethink the meaning of Equicorrelation. The change in each incorporation ratio is as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># plot allocation weighting</span>
d_allocation <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(ggweight,title){
  <span style="color:#75715e">#install.packages(&#34;tidyverse&#34;)</span>
  <span style="color:#a6e22e">library</span>(tidyverse)
  ggweight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gather</span>(ggweight,key<span style="color:#f92672">=</span>ASSET,value<span style="color:#f92672">=</span>weight,<span style="color:#f92672">-</span>Date,<span style="color:#f92672">-</span>method)
  <span style="color:#a6e22e">ggplot</span>(ggweight, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Date, y<span style="color:#f92672">=</span>weight,fill<span style="color:#f92672">=</span>ASSET)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_area</span>(colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;black&#34;</span>,size<span style="color:#f92672">=</span><span style="color:#ae81ff">.1</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">scale_y_continuous</span>(limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">labs</span>(title<span style="color:#f92672">=</span>title) <span style="color:#f92672">+</span> <span style="color:#a6e22e">facet_grid</span>(method<span style="color:#f92672">~</span>.)
}

gmv_weight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">data.frame</span>(CCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(CCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DECO<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DECO&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DECO<span style="color:#f92672">$</span>weight)))

<span style="color:#75715e"># plot allocation weighting</span>
<span style="color:#a6e22e">d_allocation</span>(gmv_weight,<span style="color:#e6db74">&#34;GMV Asset Allocation&#34;</span>)
</code></pre></div><p><img src="../../../en/post/post2/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>They seem to have increased their allocation to TLT, or U.S. Treasuries, during Lehman, while CCC and DCC have a high allocation to U.S. Treasuries in other areas as well, and the often-cited problem of a minimally diversified portfolio seems to be occurring here as well. On the other hand, DECO has a unique mix ratio, and I think we need to go back and read the paper again.</p>
<p>PS（2019/3/3）
So far, I&rsquo;ve been doing the analysis with a minimum variance portfolio, but I also wanted to see the results of risk parity, so I wrote the code for that as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">risk_parity <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(r_dat,r_cov){
  fn <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(weight, r_cov) {
    N <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NROW</span>(r_cov)
    risks <span style="color:#f92672">&lt;-</span>  weight <span style="color:#f92672">*</span> (r_cov <span style="color:#f92672">%*%</span> weight)
    g <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(risks, times <span style="color:#f92672">=</span> N) <span style="color:#f92672">-</span> <span style="color:#a6e22e">rep</span>(risks, each <span style="color:#f92672">=</span> N)
  <span style="color:#a6e22e">return</span>(<span style="color:#a6e22e">sum</span>(g^2))
  }
  dfn <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(weight,r_cov){
    out <span style="color:#f92672">&lt;-</span> weight
    <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(weight)) {
      up <span style="color:#f92672">&lt;-</span> dn <span style="color:#f92672">&lt;-</span> weight
      up[i] <span style="color:#f92672">&lt;-</span> up[i]<span style="color:#ae81ff">+.0001</span>
      dn[i] <span style="color:#f92672">&lt;-</span> dn[i]<span style="color:#ae81ff">-.0001</span>
      out[i] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">fn</span>(up,r_cov) <span style="color:#f92672">-</span> <span style="color:#a6e22e">fn</span>(dn,r_cov))<span style="color:#f92672">/</span><span style="color:#ae81ff">.0002</span>
    }
    <span style="color:#a6e22e">return</span>(out)
  }
  std <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">diag</span>(r_cov)) 
  x0 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>std<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>std)
  res <span style="color:#f92672">&lt;-</span> nloptr<span style="color:#f92672">::</span><span style="color:#a6e22e">nloptr</span>(x0<span style="color:#f92672">=</span>x0,
                 eval_f<span style="color:#f92672">=</span>fn,
                 eval_grad_f<span style="color:#f92672">=</span>dfn,
                 eval_g_eq<span style="color:#f92672">=</span><span style="color:#a6e22e">function</span>(weight,r_cov) { <span style="color:#a6e22e">sum</span>(weight) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> },
                 eval_jac_g_eq<span style="color:#f92672">=</span><span style="color:#a6e22e">function</span>(weight,r_cov) { <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">length</span>(std)) },
                 lb<span style="color:#f92672">=</span><span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">length</span>(std)),ub<span style="color:#f92672">=</span><span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">length</span>(std)),
                 opts <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#e6db74">&#34;algorithm&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NLOPT_LD_SLSQP&#34;</span>,<span style="color:#e6db74">&#34;print_level&#34;</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#34;xtol_rel&#34;</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1.0e-8</span>,<span style="color:#e6db74">&#34;maxeval&#34;</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>),
                 r_cov <span style="color:#f92672">=</span> r_cov)
  r_weight <span style="color:#f92672">&lt;-</span> res<span style="color:#f92672">$</span>solution
  <span style="color:#a6e22e">names</span>(r_weight) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colnames</span>(r_cov)
  wr_dat <span style="color:#f92672">&lt;-</span> r_dat<span style="color:#f92672">*</span>r_weight
  portfolio <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(wr_dat,<span style="color:#ae81ff">1</span>,sum)
  pr_dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(wr_dat,portfolio)
  sd <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sd</span>(portfolio)
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(r_weight,pr_dat,sd)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;weight&#34;</span>,<span style="color:#e6db74">&#34;return&#34;</span>,<span style="color:#e6db74">&#34;portfolio risk&#34;</span>)
  <span style="color:#a6e22e">return</span>(result)
  }

CCC <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;CCC&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
DCC <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;DCC&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
DECO <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;DECO&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)
benchmark <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">backtest</span>(hist.returns,<span style="color:#e6db74">&#34;benchmark&#34;</span>,<span style="color:#e6db74">&#34;2007-01-04&#34;</span>,<span style="color:#e6db74">&#34;months&#34;</span>,<span style="color:#ae81ff">365</span>,<span style="color:#e6db74">&#34;risk parity&#34;</span>)

result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">merge</span>(CCC<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,DCC<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,DECO<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio,benchmark<span style="color:#f92672">$</span>return<span style="color:#f92672">$</span>portfolio)
<span style="color:#a6e22e">colnames</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;CCC&#34;</span>,<span style="color:#e6db74">&#34;DCC&#34;</span>,<span style="color:#e6db74">&#34;DECO&#34;</span>,<span style="color:#e6db74">&#34;benchmark&#34;</span>)
</code></pre></div><p>Here&rsquo;s the result.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">PerformanceAnalytics<span style="color:#f92672">::</span><span style="color:#a6e22e">charts.PerformanceSummary</span>(result, main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BACKTEST COMPARISON&#34;</span>)

<span style="color:#a6e22e">library</span>(plotly)

<span style="color:#75715e"># plot allocation weighting</span>
riskparity_weight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">data.frame</span>(CCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(CCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DECO<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DECO&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DECO<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(benchmark<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;benchmark&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(benchmark<span style="color:#f92672">$</span>weight)))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">PerformanceAnalytics<span style="color:#f92672">::</span><span style="color:#a6e22e">charts.PerformanceSummary</span>(result, main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BACKTEST COMPARISON&#34;</span>)
</code></pre></div><p><img src="../../../en/post/post2/index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">riskparity_weight <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">data.frame</span>(CCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(CCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DCC<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DCC&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DCC<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(DECO<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DECO&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(DECO<span style="color:#f92672">$</span>weight)),<span style="color:#a6e22e">data.frame</span>(benchmark<span style="color:#f92672">$</span>weight,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;benchmark&#34;</span>,Date<span style="color:#f92672">=</span><span style="color:#a6e22e">index</span>(benchmark<span style="color:#f92672">$</span>weight)))

<span style="color:#75715e"># plot allocation weighting</span>
<span style="color:#a6e22e">d_allocation</span>(riskparity_weight, <span style="color:#e6db74">&#34;Risk Parity Asset Allocation&#34;</span>)
</code></pre></div><p><img src="../../../en/post/post2/index_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p>The results are positive, with all methods outperforming benchmark.
As expected, the estimation of the variance-covariance matrix seems to be performing well. The good performance of DECO may also be due to the fact that it uses the average of the correlation coefficients of each asset pair in the correlation matrix, which resulted in a greater inclusion of risk assets than the other methods. The weights are as follows</p>
<p>That&rsquo;s it for today, for now.</p>

          </div>

          






<div class="article-tags">
  
  <a class="badge badge-light" href="../../../en/tag/r/">R</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=../../../en/post/post2/&amp;text=I%20built%20the%20Asset%20Allocation%20Model%20in%20R." target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/en/post/post2/&amp;t=I%20built%20the%20Asset%20Allocation%20Model%20in%20R." target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=I%20built%20the%20Asset%20Allocation%20Model%20in%20R.&amp;body=/en/post/post2/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=../../../en/post/post2/&amp;title=I%20built%20the%20Asset%20Allocation%20Model%20in%20R." target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=I%20built%20the%20Asset%20Allocation%20Model%20in%20R.%20/en/post/post2/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=../../../en/post/post2/&amp;title=I%20built%20the%20Asset%20Allocation%20Model%20in%20R." target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="../../../"><img class="avatar mr-3 avatar-circle" src="../../../en/author/ayato-ashihara/avatar_hu77c0c0affdebd3b9cbda9c39412092b5_245163_270x270_fill_q90_lanczos_center.jpg" alt="Ayato Ashihara"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="../../../">Ayato Ashihara</a></h5>
      <h6 class="card-subtitle">company employee</h6>
      <p class="card-text">This blog is a nightly update by a man who is working in his forth year since completing graduate school. The content of this blog has nothing to do with the official position of the author&rsquo;s organization.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="../../../en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.facebook.com/ASSIY" target="_blank" rel="noopener">
        <i class="fab fa-facebook"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/AyatoAshihara/myblog_multi" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/%E5%BD%A9%E4%BA%BA-%E8%91%A6%E5%8E%9F-9391b7143/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "ayatoashihara-github-io-myblog-multi" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="../../../en/post/post11/" rel="next">Scraping past race results on yahoo horse racing on rvest (for the second time)</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="../../../en/post/post1/" rel="prev">Implementing Gaussian regression.</a>
  </div>
  
</div>

</div>





  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="../../../en/post/post21/">Rcpp to speed up data handling (using Tick data processing as an example)</a></li>
      
      <li><a href="../../../en/post/post14/">Fitting the 10-year long-term interest rate</a></li>
      
      <li><a href="../../../en/post/post11/">Scraping past race results on yahoo horse racing on rvest (for the second time)</a></li>
      
      <li><a href="../../../en/post/post1/">Implementing Gaussian regression.</a></li>
      
      <li><a href="../../../en/post/post19/">Is that backtest really reproducible?</a></li>
      
    </ul>
  </div>
  





        </div>
      </article>
    </main>

  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.0/mermaid.min.js" integrity="sha512-ja+hSBi4JDtjSqc4LTBsSwuBT3tdZ3oKYKd07lTVYmCnTCor56AnRql00ssqnTOR9Ss4gOP/ROGB3SfcJnZkeg==" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/sql.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/cpp.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/en/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://ayatoashihara-github-io-myblog-multi.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
      
    
    
    
    <script src="../../../js/wowchemy.min.2a3f95be2bc4762ba1847fb5d7a28317.js"></script>

    


  
  
  <div class="container">
    <footer class="site-footer">
  

  
   
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "show");
  });
  </script>
  <script src="../../../js/codefolding.js"></script>


  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy</a>  —
    the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">
    open source</a> website builder that empowers creators.
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
