<!DOCTYPE html><html lang="ja" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  
  
  <meta name="generator" content="Wowchemy 4.8.0 for Hugo">
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Ayato Ashihara">

  
  
  
    
  
  <meta name="description" content="Bayesian VAR（BVAR）と呼ばれる、VARの仲でも予測精度の向上を目材して開発されたモデルを勉強してみました。">

  
  <link rel="alternate" hreflang="ja" href="../../post/post5/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="../../js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js" integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="../../css/wowchemy.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140804055-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-140804055-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="../../index.webmanifest">
  <link rel="icon" type="image/png" href="../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="../../images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="../../post/post5/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:url" content="/post/post5/">
  <meta property="og:title" content="BVARについて | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ">
  <meta property="og:description" content="Bayesian VAR（BVAR）と呼ばれる、VARの仲でも予測精度の向上を目材して開発されたモデルを勉強してみました。"><meta property="og:image" content="/post/post5/featured.png">
  <meta property="twitter:image" content="/post/post5/featured.png"><meta property="og:locale" content="ja">
  
    
      <meta property="article:published_time" content="2018-12-01T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-04-29T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/post5/"
  },
  "headline": "BVARについて",
  
  "image": [
    "/post/post5/featured.png"
  ],
  
  "datePublished": "2018-12-01T00:00:00Z",
  "dateModified": "2019-04-29T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Ayato Ashihara"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "京都の電子部品メーカーで働く社会人が研究に没頭するブログ",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "Bayesian VAR（BVAR）と呼ばれる、VARの仲でも予測精度の向上を目材して開発されたモデルを勉強してみました。"
}
</script>

  

  


  


  





  <title>BVARについて | 京都の電子部品メーカーで働く社会人が研究に没頭するブログ</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.wcDarkLightEnabled = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="../../js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="検索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="../../">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="ナビゲーションの切り替え">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="../../">京都の電子部品メーカーで働く社会人が研究に没頭するブログ</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="../../post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>



  <div class="container-fluid docs">
  <div class="row flex-xl-nowrap">

    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
      </ul>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-unrestricted-varについて">1. Unrestricted VARについて</a></li>
        <li><a href="#2-bvarについて">2. BVARについて</a>
          <ul>
            <li><a href="#具体的な推定方法カルマンフィルタ">具体的な推定方法（カルマンフィルタ）</a></li>
            <li><a href="#カルマンフィルタの初期値をどのようにきめるか">カルマンフィルタの初期値をどのようにきめるか</a></li>
            <li><a href="#ハイパーパラメータの決定方法とその評価尺度">ハイパーパラメータの決定方法とその評価尺度</a></li>
          </ul>
        </li>
        <li><a href="#3-rでの実装">3. Rでの実装</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
    </div>

    <main class="col-12 col-md-0 col-xl-10 py-md-3 pl-md-5 docs-content" role="main">
      <article class="article">

        




















  
  
    
  


<div class="article-container pt-3">
  <h1>BVARについて</h1>

  

  


<div id="code-folding-buttons" class="dropdown btn-group pull-right">
  <a class="btn btn-light btn-sm dropdown-toggle" href="#" role="button" id="allCodeToggleButton"
     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Code
  </a>
  <div class="dropdown-menu" aria-labelledby="allCodeToggleButton">
    <a id="rmd-show-all-code" class="dropdown-item small" href="#">Show all</a>
    <a id="rmd-hide-all-code" class="dropdown-item small" href="#">Hide all</a>
  </div>
</div>



  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          最終更新
      
    
    Apr 29, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    23 分で読める
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="../../post/post5/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="../../category/%E7%B5%B1%E8%A8%88%E5%AD%A6/">統計学</a></span>
  

</div>

  














</div>


<div class="article-header container featured-image-wrapper mt-4 mb-4" style="max-width: 1200px; max-height: 527px;">
  <div style="position: relative">
    <img src="../../post/post5/featured_hub552e61dc10f8651a2990e9c048db29b_505264_1200x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



        <div class="article-container">

          <div class="article-style">
            <p>　おはこんばんにちは。日次GDP推計を休日に進めているのですが、今日は少し勉強編で<code>BVAR</code>についての記事を書きたいと思います。この<code>BVAR</code>はFRBアトランタ連銀の<code>GDPNow</code>でも使用されていることから、日次GDP推計との親和性も高いと思われます。そもそも、時系列でアウトサンプルの予測精度を上げたいということになると真っ先に思いつくのが<code>BVAR</code>です。Doan, Litterman and Sims(1984)で提案されたこのモデルは予測精度が良いので、非常に有効な手段になると思われます。<code>BVAR</code>は<code>Bayesian Vector Autoregression</code>の略で、ベクトル自己回帰モデル（<code>VAR</code>）の派生版です。<code>VAR</code>とネットで調べるとまず<code>Value at Risk</code>（<code>VaR</code>）が出てくると思いますが、それとは違います。よく見るとaが小文字になっていることに気づくかと思います。
　さて、<code>BVAR</code>の説明をこれから行おうとするのですが、その前にまず基本的な<code>VAR</code>の説明からしたいと思います。ただし、歴史的な背景（大型マクロ計量モデルからの経緯など）には触れません。あくまで、<code>BVAR</code>を説明するうえで必要な知識について触れたいと思います。</p>
<h2 id="1-unrestricted-varについて">1. Unrestricted VARについて</h2>
<p>　まず、注意点を一点。この投稿では、もっとも基本的な<code>VAR</code>のことをUnrestricted VAR（UVAR）と呼ぶことにします。UVARはSims(1980)の論文が有名です。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>このモデルには、理論的な基礎づけは原則ありません。あくまで実証的なモデルです。UVARは一般系は以下のような形をしています。</p>
<p>$$
Y_{t} = A_{0} + A_{1}Y_{t-1} + &hellip; + A_{K}Y_{t-K} + U_{t}, ~~ U_{t} ～ N(0,\Omega)
$$
$$
Y_{t} = \left(
\begin{array}{cccc}
y_{1,t} \<br>
y_{2,t} \<br>
\vdots  \<br>
y_{J,t} \<br>
\end{array}
\right),
A_{0} = \left(
\begin{array}{cccc}
a_{10} \<br>
a_{20} \<br>
\vdots  \<br>
a_{J0} \<br>
\end{array}
\right),
A_{k} = \left(
\begin{array}{cccc}
a_{11,k} &amp; a_{12,k} &amp; \ldots &amp; a_{1J,k} \<br>
a_{21,k} &amp; a_{22,k} &amp; \ldots &amp; a_{2J,k} \<br>
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>
a_{J1,k} &amp; a_{J2,k} &amp; \ldots &amp; a_{JJ,k}
\end{array}
\right),
U_{t} = \left(
\begin{array}{cccc}
u_{1,t} \<br>
u_{2,t} \<br>
\vdots  \<br>
u_{J,t} \<br>
\end{array}
\right)
$$
ここで、$t$は時点、$J$は変数の数、$K$はラグ数を表しています。上式を見ると、UVARは自己回帰＋他変数のラグでt期の変数$y_{j,t}$を説明しようとするモデルであると言えます。しばしば、経済の実証分析で使用され、インサンプルの当てはまりが良いことも知られています（GDP、消費、投資、金利、マネーサプライの５変数<code>VAR</code>で金融政策の波及経路を分析したり･･･）。推定するパラメータの個数は、回帰式1本だけでJK+1個（定数項込み）の係数を含むので、J本になればJ(JK+1)個になります。また、$\Omega$がJ(J+1)/2個のパラメータを持っているので、合計J(JK+1)+J(J+1)/2個のパラメータを推定することになり、かなりパラメータ数が多い印象です（これは後々重要になってきます）。具体的な推計方法ですが、UVARは同時方程式体系ではないのでそこまで面倒ではありません。UVAR自体は<code>Seemingly Unrestricted Regression Equation</code>（SUR）の一種でそれぞれの方程式は誤差項の相関を通じて関係してはいますが（$\Omega$の部分）、全ての回帰式が同じ説明変数を持つため、各方程式を最小二乗法（<code>OLS</code>）によって推定するだけで良いことが知られています。
　この事実を説明してみましょう（<code>BVAR</code>が気になる方は読み飛ばしてもらって構いません）。説明のために今、UVARをSURの一般系に書き直します。上式はt期の<code>VAR</code>(K)システムですが、UVARを推定する際はこれらJ本の方程式がサンプル数Tセット分存在するので、実際のシステム体系は以下のようになります。</p>
<p>$$
\left(
\begin{array}{cccc}
Y_{1} \<br>
Y_{2} \<br>
\vdots  \<br>
Y_{J} \<br>
\end{array}
\right) = 
\left(
\begin{array}{cccc}
X_{1} &amp; 0 &amp; \ldots &amp; 0 \<br>
0 &amp; X_{2} &amp; \ldots &amp; 0 \<br>
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>
0 &amp; 0 &amp; \ldots &amp; X_{J}
\end{array}
\right) 
\left(
\begin{array}{cccc}
A_{1} \<br>
A_{2} \<br>
\vdots  \<br>
A_{J} \<br>
\end{array}
\right) +
\left(
\begin{array}{cccc}
U_{1} \<br>
U_{2} \<br>
\vdots  \<br>
U_{J} \<br>
\end{array}
\right) = \overline{X}A + U (1式)
$$
ここで、</p>
<p>$$
Y_{j} = \left(
\begin{array}{cccc}
y_{t,j} \<br>
y_{t+1,j} \<br>
\vdots  \<br>
y_{T,j} \<br>
\end{array}
\right) ,
X_{j} = X = \left(
\begin{array}{cccc}
1 &amp; y_{t-1,1} &amp; \ldots &amp; y_{t-K,1} &amp; \ldots &amp; y_{t-K,J} \<br>
1 &amp; y_{t,1} &amp; \ldots &amp; y_{t-K+1,1} &amp; \ldots &amp; y_{t-K+1,J} \<br>
\vdots &amp; \vdots &amp; \ldots &amp; \ldots &amp; \ddots &amp; \vdots \<br>
1 &amp; y_{T-1,1} &amp; \ldots &amp; y_{T-K,1} &amp; \ldots &amp; y_{T-K,J} \<br>
\end{array}
\right),
A_{j} = \left(
\begin{array}{cccc}
a_{00,j} \<br>
a_{11,j} \<br>
\vdots  \<br>
a_{JK,j} \<br>
\end{array}
\right)
$$
です。上式とは違い、変数順で並べられていることに注意してください（つまり、各方程式を並べる優先順位は１番目にj、２番目にtとなっている）。また、$X_{j}$が全ての変数$j$について等しいことに注目してください（jに依存していません、<code>VAR</code>なので当たり前ですが）。これが後々非常に重要になってきます。$U$の分散共分散行列は</p>
<p>$$
E[UU'|X_{1}, X_{2},..,X_{J}] = \Omega = 
\left(
\begin{array}{cccc}
\sigma_{11}I &amp; \sigma_{12}I &amp; \ldots &amp; \sigma_{1J}I \<br>
\sigma_{21}I &amp; \sigma_{22}I &amp; \ldots &amp; \sigma_{2J}I \<br>
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>
\sigma_{J1}I &amp; \sigma_{J2}I &amp; \ldots &amp; \sigma_{JJ}I \<br>
\end{array}
\right)
$$</p>
<p>となっており、それぞれの変数は誤差項の相関を通じて関係しています（ただし、同じ変数内の異なる時点間の相関はないと仮定します）。このような場合、一般化最小二乗法（<code>GLS</code>）を用いて推計を行うことになりますが、これら方程式体系において説明変数が同じであるならば、<code>GLS</code>推定量と<code>OLS</code>推定量は同値になります。それを確かめてみましょう。上述した方程式体系(1)の<code>GLS</code>推定量は以下になります（<a href="http://user.keio.ac.jp/~nagakura/zemi/GLS.pdf" target="_blank" rel="noopener">参考</a>）。</p>
<p>$$
A_{GLS} = (\overline{X}'\Omega^{-1}\overline{X})^{-1}\overline{X}'\Omega^{-1}Y = (\overline{X}'(\Sigma^{-1}\otimes I)\overline{X})^{-1}\overline{X}'(\Sigma^{-1}\otimes I)Y
$$</p>
<p>ここで、$\Sigma$は誤差項の分散共分散行列のうち、スカラーである分散、共分散を取り出した行列です。先ほど確認したように、$X_{1}=X_{2}=&hellip;=X_{J}=X$なので$\overline{X}=I \otimes X$であり、その転置も$\overline{X}'=I \otimes X$となります。よって、<a href="https://mathwords.net/kuronekaseki" target="_blank" rel="noopener">この</a>の性質を用いると、</p>
<p>$$
<code>\begin{eqnarray} A_{GLS} &amp;=&amp; [(I \otimes X')(\Sigma^{-1}\otimes I)(I \otimes X)]^{-1}(I \otimes X')(\Sigma^{-1}\otimes I)Y \\ &amp;=&amp; [(\Sigma^{-1}\otimes X')(I \otimes X)]^{-1}(\Sigma^{-1}\otimes X')y \\ &amp;=&amp; (\Sigma^{-1}\otimes(X'X))^{-1}(\Sigma^{-1}\otimes X')y \\ &amp;=&amp; (I \otimes (X'X)^{-1}X')y \\ &amp;=&amp; (\overline{X}'\overline{X})^{-1}\overline{X}'Y \\ &amp;=&amp;  \left( \begin{array}{cccc} (X'X)^{-1}X' &amp; 0 &amp; \ldots &amp; 0 \\ 0 &amp; (X'X)^{-1}X' &amp; \ldots &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \ldots &amp; (X'X)^{-1}X' \end{array} \right)  \left( \begin{array}{cccc} Y_{1} \\ Y_{2} \\ \vdots  \\ Y_{J} \\ \end{array} \right)\\  &amp;=&amp; \left( \begin{array}{cccc} (X'X)^{-1}X'Y_{1} \\ (X'X)^{-1}X'Y_{2} \\ \vdots  \\ (X'X)^{-1}X'Y_{J} \\ \end{array} \right) \\ &amp;=&amp; \left( \begin{array}{cccc} A_{1,OLS} \\ A_{2,OLS} \\ \vdots  \\ A_{J,OLS} \\ \end{array} \right) \end{eqnarray}</code>
$$</p>
<p>となり、各経済変数の方程式を別個に<code>OLS</code>推計していけばよいことがわかります。
　<code>OLS</code>推定に際し、<code>VAR</code>の次数Kの選択を選択する必要がありますが、次数Kは<code>AIC</code>（<code>BIC</code>）を評価軸に探索的に決定します。つまり、いろいろな値をKに設定し、<code>OLS</code>推計を行い、計算された<code>VAR</code>(K)の<code>AIC</code>(<code>BIC</code>)のうちで最も値が大きいモデルの次数を真のモデルの次数Kとして採用するということです。<code>R</code>にも<code>VARselect()</code>という関数があり、引数にラグの探索最大数とデータを渡すことで最適な次数を計算してくれます（便利）。
　このようにUVARは<code>OLS</code>推計で各変数間の相互依存関係をデータから推計できる手軽な手法です。私が知っている分野ですと財政政策乗数の推計に使用されていました。GDP、消費、投資、政府支出の４変数で<code>VAR</code>を推定し、推定した<code>VAR</code>でインパルス応答を見ることで１単位の財政支出の増加がGDP等に与える影響を定量的にシミュレートすることができたりします（指導教官が論文を書いてました）。そもそも私の専門の<code>DSGE</code>も誘導系に書き直せば<code>VAR</code>形式になり、インパルス応答などは基本的に一緒です。また、経済変数は慣性が強いので（特に我が国の場合）、インサンプルのモデルの当てはまりもいいです。ただし、あくまでインサンプルです。<b>アウトサンプルの当てはまりはそれほど良い印象はありません。</b>なぜなら、推定パラメータが多すぎるからです。UVARの予測に関する問題点は<code>over-parametrization</code>です。例えば、先ほどの４変数UVARでラグが６期だったとすると、推定すべきパラメータは３１個になります。よって、データ数にもよりますが、パラメータ数がデータ数に近づくとインサンプルの補間に近づき、過学習を引き起こす危険性があります。日次GDP推計は大量の変数を使用するのでこの問題は非常に致命的になります。<code>BVAR</code>はこの問題を解決することに主眼を置いています。</p>
<h2 id="2-bvarについて">2. BVARについて</h2>
<p>　UVARの問題点は<code>over-parametrization</code>であると述べました。<code>BVAR</code>はこの問題を防ぐために不必要な説明変数（のパラメータ）をそぎ落とそうとします。ただ、不要なパラメータを推定する前に０と仮置き（カリブレート）するのではなく、１階の自己に関わるパラメータは１周り、その他変数のパラメータは０周りに正規分布するという形の制約を与えます。このモデルの最大の仮定は「各経済変数は多かれ少なかれドリフト付き１階のランダムウォークに従う」というものであり、上述したような事前分布を先験的に与えた上で推定を行うのです。砕けた言い方をすると、<code>BVAR</code>の考え方は「経済変数の挙動は基本はランダムウォークだけど他変数のラグに予測力向上に資するものがあればそれも取り入れるよ」というものなんです。さて、前置きが長くなりましたが、具体的な説明に移りたいと思います。</p>
<h3 id="具体的な推定方法カルマンフィルタ">具体的な推定方法（カルマンフィルタ）</h3>
<p>　上述した事前分布に加えて、<code>BVAR</code>がUVARと異なる点はパラメータが<code>time-varying</code>であるということです。なんとなく、パラメータがずっと固定よりもサンプルが増えるたびにその値が更新されるほうが予測精度が上がりそうですよね（笑）。推定手法としてはUVARの時のように<code>OLS</code>をそれぞれにかけることはせず、<a href="https://qiita.com/MoriKen/items/0c80ef75749977767b43" target="_blank" rel="noopener">カルマンフィルタ</a> と呼ばれるアルゴリズムを用いて推定を行います。<code>BVAR</code>は以下のような状態空間モデルとして定義されます（各ベクトル、行列の次元はUVAR時と同じです）。</p>
<p>$$
Y_{t} = X_{t}B_{t} + u_{t} \<br>
B_{t} = \Phi B_{t-1} + \epsilon_{t} \<br>
B_{t} = \left(
\begin{array}{cccc}
\beta_{00,t} \<br>
\beta_{11,t} \<br>
\vdots  \<br>
\beta_{JK,t} \<br>
\end{array}
\right), 
\Phi = \left(
\begin{array}{cccc}
\phi_{00} &amp; 0 &amp; \ldots &amp; 0 \<br>
0 &amp; \phi_{11} &amp; \ldots &amp; 0 \<br>
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>
0 &amp; 0 &amp; \ldots &amp; \phi_{JK}
\end{array}
\right),
u_{t} = \left(
\begin{array}{cccc}
u_{1,t} \<br>
u_{2,t} \<br>
\vdots  \<br>
u_{J,t} \<br>
\end{array}
\right),
\epsilon_{t} = \left(
\begin{array}{cccc}
\epsilon_{00,t} \<br>
\epsilon_{11,t} \<br>
\vdots  \<br>
\epsilon_{JK,t} \<br>
\end{array}
\right)
$$
状態空間モデルは観測可能なデータ（ex.経済統計）を用いて、観測不可能なデータ（ex.リスクプレミアムや限界消費性向等）を推定します。観測可能なデータと不可能なデータを関連付ける方程式を観測方程式、観測不可能なデータの挙動をモデル化した方程式を遷移方程式と呼びます。ここでは、1本目が観測方程式、2本目が遷移方程式となります。御覧の通り、観測方程式は通常の<code>VAR</code>の形をしている一方、遷移方程式は<code>AR(1)</code>となっており、これによってパラメータ$B_{t}$は過去の値を引きずりながら$\epsilon_{t}$によって確率的に変動します。$\Phi$は自己回帰係数です。誤差項$u_{t}$と$\epsilon_{t}$は平均０の正規分布に従い、その分散は</p>
<p>$$
<code>\begin{eqnarray} Var(u_{t}) &amp;=&amp; \sigma_{u}^{2} \\ Var(\epsilon_{t}) &amp;=&amp; \sigma_{\epsilon}^{2}R \end{eqnarray}</code>
$$
で与えられます。ここで、$\Phi,R,\sigma_{u}^{2},\sigma_{\epsilon}^{2}$は既知であるとします。今、t-1期までのデータが入手可能であるとすると、そのデータをカルマンフィルタアルゴリズムで推定した$B_{t-1|t-1}$とその分散共分散行列$P_{t-1|t-1}$を用いて、t期の予想値を以下のように計算します。</p>
<p>$$
<code>\begin{eqnarray} B_{t|t-1} &amp;=&amp; \Phi B_{t-1|t-1} \\ P_{t|t-1} &amp;=&amp; \Phi P_{t|t-1} \Phi' + \sigma_{\epsilon}^{2}R \end{eqnarray}</code>
$$
観測可能な変数の予測値はこの値を用いて計算します。</p>
<p>$$
\hat{Y_{t}} = X_{t} B_{t|t-1}
$$
次にt期の観測値が得られると次の更新方程式を用いて$B_{t|t}, P_{t|t}$を計算します。</p>
<p>$$
<code>\begin{eqnarray} B_{t|t} &amp;=&amp; B_{t|t-1} + P_{t|t-1}X_{t}'(X_{t}P_{t|t-1}X_{t}' + \sigma_{u}^{2})^{-1}(Y_{t}-X_{t}B_{t|t-1}) \\ P_{t|t} &amp;=&amp; P_{t|t-1} + P_{t|t-1}X_{t}'(X_{t}P_{t|t-1}X_{t}' + \sigma_{u}^{2})^{-1}X_{t}P_{t|t-1} \end{eqnarray}</code>
$$
<code>\(\sigma_{\epsilon}^{2}R = 0\)</code>かつ$\Phi = I$の場合は<code>逐次最小二乗法</code>に一致します。要は入手できるサンプル増えるたびに<code>OLS</code>をやり直していくことと同値だということです。こうして推計を行うのが<code>BVAR</code>なのですが、カルマンフィルタは漸化式なので初期値$B_{0|0}, P_{0|0}$を決めてやる必要があります。<code>BVAR</code>の２つ目の特徴は初期値の計算に混合推定法を用いているところであり、ここに前述した事前分布が関係してきます。</p>
<h3 id="カルマンフィルタの初期値をどのようにきめるか">カルマンフィルタの初期値をどのようにきめるか</h3>
<p>初期値$B_{0|0}, P_{0|0}$をどうやって計算するのかを考えた際にすぐ思いつく方法としては、カルマンフィルタのスタート地点tの前に、初期値推計期間をある程度用意し、$Y = XB + \epsilon$で$B_{0|0}, P_{0|0}$を推定する方法があります。つまり、観測方程式を<code>GLS</code>推計し、そのパラメータを初期値とする方法です。その際の<code>GLS</code>推定量は</p>
<p>$$
\hat{B} = (X&rsquo;V^{-1}X)^{-1}X&rsquo;V^{-1}Y
$$</p>
<p>です。これでもいいんですが、これではただ時変パラメータを推計しているだけで先ほど述べた<code>over-parametrization</code>の問題にはアプローチできていません。そこで、ここではパラメータ$B$に対してなにか先験的な情報が得られているとしましょう。つまり、先述した「経済変数の挙動は基本はランダムウォークだけど他変数のラグに予測力向上に資するものがあればそれも取り入れるよ」という予想です。これを定式化してみましょう。つまり、パラメータ$B$に対して以下の制約式を課します。</p>
<p>$$
r = RB + \nu
$$
ここで、$E(\nu) = 0,Var(\nu) = V_{0}$です。また、$r$は$RB$の予想値であり、$V_{0}$はその予想値の周りでのばらつきを表しています。取っ付きにくいかもしれませんが、$r$は１階自己回帰係数に関わる部分は1、それ以外は0となるベクトルで、$R$は単位行列$I$だと思ってもらえばいいです。つまり、</p>
<p>$$
<code>\begin{eqnarray} \left( \begin{array}{cccc} 0 \\ 1 \\ 0 \\ \vdots  \\ 1 \\ \vdots  \\ 0 \\ \end{array} \right) &amp;=&amp;  \left( \begin{array}{cccc} 　  \beta_{0,1}^{1} \\ \beta_{1,1}^{1} \\ \beta_{2,1}^{1} \\ \vdots  \\ \beta_{j,1}^{j} \\ \vdots  \\ \beta_{J,K}^{J} \\ \end{array} \right) + \left( \begin{array}{cccc} \nu_{0,1}^{1} \\ \nu_{1,1}^{1} \\ \nu_{2,1}^{1}  \\ \vdots  \\ \nu_{j,1}^{j}  \\ \vdots  \\ \nu_{J,K}^{J} \\ \end{array} \right) \end{eqnarray}</code>
$$
みたいな感じです。ここで$\beta_{j,k}^{i}$はi番目の方程式のj番目の変数のk次ラグにかかるパラメータを表しています。混合推定では、正規分布に従う観測値とこの事前分布が独立であるという仮定の下で観測方程式$Y = XB + \epsilon$と$ r = RB + \nu$を以下のように組み合わせます。</p>
<p>$$
\left(
\begin{array}{cccc}
Y \<br>
r 
\end{array}
\right) = \left(
\begin{array}{cccc}
X \<br>
R 
\end{array}
\right)B + 
\left(
\begin{array}{cccc}
\epsilon \<br>
\nu 
\end{array}
\right)
$$</p>
<p>ここで、</p>
<p>$$
E\left(
\begin{array}{cccc}
\epsilon \<br>
\nu 
\end{array}
\right) = 0 \<br>
Var\left(
\begin{array}{cccc}
\epsilon \<br>
\nu 
\end{array}
\right) = \left(
\begin{array}{cccc}
\sigma^{2}V &amp; 0 \<br>
0 &amp; V_{0} \<br>
\end{array}
\right)
$$</p>
<p>そして、このシステム体系を<code>GLS</code>で推計するのです。こうすることで、事前分布を考慮した初期値の推定を行うことができます。<code>GLS</code>推定量は以下のようになります。</p>
<p><code>\(\displaystyle \hat{B}_{M} = (\frac{1}{\sigma^{2}}X'V^{-1}X + R'V_{0}^{-1}R)^{-1}(\frac{1}{\sigma^{2}}X'V^{-1}y + R'V_{0}^{-1}r)\)</code></p>
<p>ご覧になればわかるように、<code>GLS</code>推定量は上記2本の連立方程式(実際には行列なので何本もありますが)それぞれのGLS推定量を按分したような推定量になります。ここで、$\sigma^{2}$は既知ではないので、いったん<code>OLS</code>で推計しその推定量を用います。問題は$V_{0}$の置き方です。$V_{0}$の各要素を小さくとれば、事前分布に整合的な推定量が得られます（つまり、ランダムウォーク）。逆に、大きくとれば通常の<code>GLS</code>推定量に近づいていきます。Doan, Litternam and Sims (1984)では以下のように分散を置いています。</p>
<p>$$
<code>\begin{eqnarray} \displaystyle Var(\beta_{j,k}^{j}) &amp;=&amp; \frac{\pi_{5}・\pi_{1}}{k・exp(\pi_{4}w_{i}^{i})} \\ \displaystyle Var(\beta_{j,k}^{i}) &amp;=&amp; \frac{\pi_{5}・\pi_{2}・\sigma_{i}^{2}}{k・exp(\pi_{4}w_{j}^{i})・\sigma_{j}^{2}} \\ Var(c^{i}) &amp;=&amp; \pi_{5}・\pi_{3}・\sigma_{i}^{2} \end{eqnarray}</code>
$$</p>
<p>ここで、$\beta_{j,k}^{j}$は$i$番目の方程式の自己回帰パラメータ、$\beta_{j,k}^{i}$は$i$番目方程式の他変数ラグ項にかかるパラメータ、$c^{i}$は定数項です。そして、$\pi_{1},\pi_{2},\pi_{3},\pi_{4},\pi_{5}$はハイパーパラメータと呼ばれるもので、カルマンフィルタにかけるパラメータの初期値の事前分布の分布の広がりを決定するパラメータとなっています。これらは初期値の推定を行う前に値を指定する必要があります。各ハイパーパラメータの具体的な特徴は以下の通りです。$\pi_{1}$は$\beta_{j,k}^{j}$の分散にのみ出現することから自己回帰係数に影響を与えるパラメータとなっています。具体的には、$\pi_{1}$が大きくなればなるほど自己回帰係数は事前分布から大きく離れた辺りを取りうることになります。$\pi_{2}$は$\beta_{j,k}^{i}$の分散にのみ出現することから他変数のラグ項に影響を与えるパラメータとなっています。こちらも値が大きくなればなるほど係数は事前分布から大きく離れた辺りを取りうることになります。$\pi_{3}$は定数項の事前分布に影響を与えるパラメータでこちらも考え方は同じです。$\pi_{4}$はラグ項の分散(つまり定数項以外)に影響を与えるパラメータで、値が大きくなるにつれ、初期値は事前分布に近づいていきます。最後に$\pi_{5}$ですが、こちらは全体にかかるパラメータで、値が大きくなるにつれ、初期値は事前分布から遠ざかります。</p>
<p>　上式には、ハイパーパラメータ以外にもパラメータや変数が存在します。$\sigma_{i}, \sigma_{j}$は$y_{j,t}, y_{i,t}$をそれぞれ<code>AR(m)</code>でフィッティングをかけた時の残差の標準偏差の推定値です。変数間のスケーリングの違いを考慮するために、$\sigma_{i}$を$\sigma_{j}$で割ったものを使用しています。本来ならば、<code>VAR</code>の残差の標準偏差を使用すべきなのですが、推定する前にわかるわけもないので、それぞれ<code>AR(m)</code>で推定をかけ、その標準偏差を使用しています((ランダムウォークが先験情報なので整合性は取れているような気がします))。$w_{j}^{i}$は完全に恣意的なパラメータで、DLSではrelative weightsと呼ばれているものです。i番目の方程式のj番目の変数のラグ項にかかるパラメータが０であるかどうかについて、分析者の先験情報を反映するためのパラメータです。分散の式を見ればわかるように、relative weightが大きくなれば分散は小さくなり、推定値は事前分布に近づいていきます。DLSでは、ほとんどの変数は$w_{i}^{i}=0,w_{j}^{i}=1$でよいと主張されています。つまり、自己ラグにかかる事前分布の分散に関しては確信をもってランダムウォークであるといえる一方、他変数ラグについては予測力向上に役立つもののあることを考え、値を１と置いているのです。一方、為替レートや株価はランダムウォーク色が強いということから大きい値を使用しています。最後に、$Var(\beta_{j,k}^{j})$と$Var(\beta_{j,k}^{i})$には分母にkがついています。つまり、ラグ次数kが大きくなればなるほど、その係数は０に近づいていくことを先験的情報として仮定していることになります((このおかげで<code>VAR</code>の次数をこちらで指定する必要がなくなります。適当に大きい次数を指定しておけば、必要のない次数の大きいパラメータに関しては事前と値が０になるので。))。
　
　これらがいわゆる<code>Minnesota Prior</code>の正体です((実はこれに加えて自己回帰パラメータの総和が１、他変数のラグ項にかかるパラメータの総和が０となる制約を課すのですが、話が複雑になりすぎるので今回は割愛しました))。初期値が事前分布に近づけば<code>BVAR</code>はランダムウォークに近づきますし、離れるとUVARに近づきます。現実はその間となるのですが、なにを評価尺度としてハイパーパラメータの値を決めるかというと、それは当てはまりの良さということになります。</p>
<h3 id="ハイパーパラメータの決定方法とその評価尺度">ハイパーパラメータの決定方法とその評価尺度</h3>
<p>当てはまりの良さと言ってもいろいろありますが、DLSはその時点で観測可能なデータから予測できるk期先の予測値の当てはまりの良さを基準としています。DLSでは以下の予測誤差ベクトル$\hat{\epsilon}_{t+k|t}$のクロス積和を最小化することを目的関数として、ハイパーパラメータのチューニングを行っています。</p>
<p>$$
\hat{\epsilon}<em>{t+k|t} = \hat{Y}</em>{t+k|t}-Y_{t+k}
$$
ここで、$\hat{Y}_{t+k|t}$はカルマンフィルタによるk期先の予測値です（kをいくつ先にすれば良いかは不明）。このクロス積は$\hat{\epsilon}_{t+k|t}\hat{\epsilon}'_{t+k|t}$であり、これをフィルタリングをかけるt=1期からサンプル期間であるt=T期まで計算していくので、最終的にはT個の予測誤差ベクトルを得ることになり、以下のようなこれらの総和を最小化します。</p>
<p>$$
\displaystyle \sum_{t=1}^{T-k}\hat{\epsilon}_{t+k|t}\hat{\epsilon}'_{t+k|t}
$$
より厳密にはこのクロス積和の対数値を最小化するハイパーパラメータの値をグリッドサーチやランダムサーチで探索していくことになります((ここは機械学習等で用いられているベイズ最適化を利用するとより高速に収束させることが可能かもです。))。
とまあ、<code>BVAR</code>の推定方法はこんな感じです。他の<code>VAR</code>と違い、恣意的であり、また推定方法が機械学習に近い点が特徴ではないかと思います。そもそも、<code>BVAR</code>は予測に特化した<code>VAR</code>ですから、他の<code>VAR</code>とは別物と考える方が良いかもです。</p>
<p>（追記　2019/4/29）</p>
<h2 id="3-rでの実装">3. Rでの実装</h2>
<p>ここまでを<code>R</code>で実装したいと思います。まずは、<code>vars</code>パッケージに準備されているCanadaデータを使用して、通常の<code>VAR</code>の推定をやってみます。これはカナダの1980～2000年の労働生産性、雇用、失業率、実質賃金をまとめたものになります。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(vars)

<span style="color:#a6e22e">data</span>(Canada)
Canada.var <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">VAR</span>(Canada,p<span style="color:#f92672">=</span><span style="color:#a6e22e">VARselect</span>(Canada,lag.max <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)<span style="color:#f92672">$</span>selection[1])
<span style="color:#a6e22e">summary</span>(Canada.var)
</code></pre></div><pre><code>## 
## VAR Estimation Results:
## ========================= 
## Endogenous variables: e, prod, rw, U 
## Deterministic variables: const 
## Sample size: 81 
## Log Likelihood: -150.609 
## Roots of the characteristic polynomial:
## 1.004 0.9283 0.9283 0.7437 0.7437 0.6043 0.6043 0.5355 0.5355 0.2258 0.2258 0.1607
## Call:
## VAR(y = Canada, p = VARselect(Canada, lag.max = 4)$selection[1])
## 
## 
## Estimation results for equation e: 
## ================================== 
## e = e.l1 + prod.l1 + rw.l1 + U.l1 + e.l2 + prod.l2 + rw.l2 + U.l2 + e.l3 + prod.l3 + rw.l3 + U.l3 + const 
## 
##           Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1       1.75274    0.15082  11.622  &lt; 2e-16 ***
## prod.l1    0.16962    0.06228   2.723 0.008204 ** 
## rw.l1     -0.08260    0.05277  -1.565 0.122180    
## U.l1       0.09952    0.19747   0.504 0.615915    
## e.l2      -1.18385    0.23517  -5.034 3.75e-06 ***
## prod.l2   -0.10574    0.09425  -1.122 0.265858    
## rw.l2     -0.02439    0.06957  -0.351 0.727032    
## U.l2      -0.05077    0.24534  -0.207 0.836667    
## e.l3       0.58725    0.16431   3.574 0.000652 ***
## prod.l3    0.01054    0.06384   0.165 0.869371    
## rw.l3      0.03824    0.05365   0.713 0.478450    
## U.l3       0.34139    0.20530   1.663 0.100938    
## const   -150.68737   61.00889  -2.470 0.016029 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## 
## Residual standard error: 0.3399 on 68 degrees of freedom
## Multiple R-Squared: 0.9988,	Adjusted R-squared: 0.9985 
## F-statistic:  4554 on 12 and 68 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation prod: 
## ===================================== 
## prod = e.l1 + prod.l1 + rw.l1 + U.l1 + e.l2 + prod.l2 + rw.l2 + U.l2 + e.l3 + prod.l3 + rw.l3 + U.l3 + const 
## 
##           Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1      -0.14880    0.28913  -0.515   0.6085    
## prod.l1    1.14799    0.11940   9.615 2.65e-14 ***
## rw.l1      0.02359    0.10117   0.233   0.8163    
## U.l1      -0.65814    0.37857  -1.739   0.0866 .  
## e.l2      -0.18165    0.45083  -0.403   0.6883    
## prod.l2   -0.19627    0.18069  -1.086   0.2812    
## rw.l2     -0.20337    0.13337  -1.525   0.1319    
## U.l2       0.82237    0.47034   1.748   0.0849 .  
## e.l3       0.57495    0.31499   1.825   0.0723 .  
## prod.l3    0.04415    0.12239   0.361   0.7194    
## rw.l3      0.09337    0.10285   0.908   0.3672    
## U.l3       0.40078    0.39357   1.018   0.3121    
## const   -195.86985  116.95813  -1.675   0.0986 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## 
## Residual standard error: 0.6515 on 68 degrees of freedom
## Multiple R-Squared:  0.98,	Adjusted R-squared: 0.9765 
## F-statistic: 277.5 on 12 and 68 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation rw: 
## =================================== 
## rw = e.l1 + prod.l1 + rw.l1 + U.l1 + e.l2 + prod.l2 + rw.l2 + U.l2 + e.l3 + prod.l3 + rw.l3 + U.l3 + const 
## 
##           Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1    -4.716e-01  3.373e-01  -1.398    0.167    
## prod.l1 -6.500e-02  1.393e-01  -0.467    0.642    
## rw.l1    9.091e-01  1.180e-01   7.702 7.63e-11 ***
## U.l1    -7.941e-04  4.417e-01  -0.002    0.999    
## e.l2     6.667e-01  5.260e-01   1.268    0.209    
## prod.l2 -2.164e-01  2.108e-01  -1.027    0.308    
## rw.l2   -1.457e-01  1.556e-01  -0.936    0.353    
## U.l2    -3.014e-01  5.487e-01  -0.549    0.585    
## e.l3    -1.289e-01  3.675e-01  -0.351    0.727    
## prod.l3  2.140e-01  1.428e-01   1.498    0.139    
## rw.l3    1.902e-01  1.200e-01   1.585    0.118    
## U.l3     1.506e-01  4.592e-01   0.328    0.744    
## const   -1.167e+01  1.365e+02  -0.086    0.932    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## 
## Residual standard error: 0.7601 on 68 degrees of freedom
## Multiple R-Squared: 0.9989,	Adjusted R-squared: 0.9987 
## F-statistic:  5239 on 12 and 68 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation U: 
## ================================== 
## U = e.l1 + prod.l1 + rw.l1 + U.l1 + e.l2 + prod.l2 + rw.l2 + U.l2 + e.l3 + prod.l3 + rw.l3 + U.l3 + const 
## 
##          Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1     -0.61773    0.12508  -4.939 5.39e-06 ***
## prod.l1  -0.09778    0.05165  -1.893 0.062614 .  
## rw.l1     0.01455    0.04377   0.332 0.740601    
## U.l1      0.65976    0.16378   4.028 0.000144 ***
## e.l2      0.51811    0.19504   2.656 0.009830 ** 
## prod.l2   0.08799    0.07817   1.126 0.264279    
## rw.l2     0.06993    0.05770   1.212 0.229700    
## U.l2     -0.08099    0.20348  -0.398 0.691865    
## e.l3     -0.03006    0.13627  -0.221 0.826069    
## prod.l3  -0.01092    0.05295  -0.206 0.837180    
## rw.l3    -0.03909    0.04450  -0.879 0.382733    
## U.l3      0.06684    0.17027   0.393 0.695858    
## const   114.36732   50.59802   2.260 0.027008 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## 
## Residual standard error: 0.2819 on 68 degrees of freedom
## Multiple R-Squared: 0.9736,	Adjusted R-squared: 0.969 
## F-statistic: 209.2 on 12 and 68 DF,  p-value: &lt; 2.2e-16 
## 
## 
## 
## Covariance matrix of residuals:
##             e     prod       rw        U
## e     0.11550 -0.03161 -0.03681 -0.07034
## prod -0.03161  0.42449  0.05589  0.01494
## rw   -0.03681  0.05589  0.57780  0.03660
## U    -0.07034  0.01494  0.03660  0.07945
## 
## Correlation matrix of residuals:
##            e     prod      rw        U
## e     1.0000 -0.14276 -0.1425 -0.73426
## prod -0.1428  1.00000  0.1129  0.08136
## rw   -0.1425  0.11286  1.0000  0.17084
## U    -0.7343  0.08136  0.1708  1.00000
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">predict</span>(Canada.var,n.ahead<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,ci<span style="color:#f92672">=</span><span style="color:#ae81ff">0.95</span>))
</code></pre></div><p><img src="../../post/post5/index_files/figure-html/r-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>パッケージが整備されているので簡単に実行できました。上で見たようにやっていることは別々の<code>OLS</code>を4本推定しているだけです。
次に<code>BVAR</code>です。まず、カルマンフィルタと事前分布を定義します。カルマンフィルタは以前記事でご紹介したものと同じです。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(seasonal)

kalmanfiter <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(y,I,t,z,c<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,R<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>,Q<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>,d<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,S<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>,h<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>,a_int<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>,sig_int<span style="color:#f92672">=</span><span style="color:#66d9ef">NA</span>){
  <span style="color:#75715e">#-------------------------------------------------------------------</span>
  <span style="color:#75715e"># Implemention of Kalman filter</span>
  <span style="color:#75715e">#   y - observed variable</span>
  <span style="color:#75715e">#   I - the number of unobserved variable</span>
  <span style="color:#75715e">#   t - parameter of endogenous variable in state equation</span>
  <span style="color:#75715e">#   z - parameter of endogenous variable in observable equation</span>
  <span style="color:#75715e">#   c - constant in state equaion</span>
  <span style="color:#75715e">#   R - parameter of exogenous variable in state equation</span>
  <span style="color:#75715e">#   Q - var-cov matrix of exogenous variable in state equation</span>
  <span style="color:#75715e">#   d - constant in observable equaion</span>
  <span style="color:#75715e">#   S - parameter of exogenous variable in observable equation</span>
  <span style="color:#75715e">#   h - var-cov matrix of exogenous variable in observable equation</span>
  <span style="color:#75715e">#   a_int - initial value of endogenous variable</span>
  <span style="color:#75715e">#   sig_int - initial value of variance of endogenous variable</span>
  <span style="color:#75715e">#-------------------------------------------------------------------</span>
  
  <span style="color:#a6e22e">library</span>(MASS)
    
  <span style="color:#75715e"># 1.Define Variable</span>
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">class</span>(y)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;matrix&#34;</span>){
    y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(y)
  }
  N <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NROW</span>(y) <span style="color:#75715e"># sample size</span>
  L <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NCOL</span>(y) <span style="color:#75715e"># the number of observable variable </span>
  a_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(I,<span style="color:#ae81ff">1</span>,N)) <span style="color:#75715e"># prediction of unobserved variable</span>
  a_fil <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(I,<span style="color:#ae81ff">1</span>,N<span style="color:#ae81ff">+1</span>)) <span style="color:#75715e"># filtered of unobserved variable</span>
  sig_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(I,I,N)) <span style="color:#75715e"># prediction of var-cov mat. of unobserved variable</span>
  sig_fil <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(I,I,N<span style="color:#ae81ff">+1</span>)) <span style="color:#75715e"># filtered of var-cov mat. of unobserved variable</span>
  y_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(L,<span style="color:#ae81ff">1</span>,N)) <span style="color:#75715e"># prediction of observed variable</span>
  F_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(L,L,N)) <span style="color:#75715e"># auxiliary variable </span>
  k <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(I,L,N)) <span style="color:#75715e"># kalman gain</span>
  
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(a_int))){
    a_int <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">0</span>,nrow <span style="color:#f92672">=</span> I,ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(sig_int))){
    sig_int <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> I,ncol <span style="color:#f92672">=</span> I)
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(R))){
    R <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> I,ncol <span style="color:#f92672">=</span> I)
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(Q))){
    Q <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> I,ncol <span style="color:#f92672">=</span> I)
  }
  <span style="color:#a6e22e">if</span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(S))){
    S <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> L,ncol <span style="color:#f92672">=</span> L)
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">any</span>(<span style="color:#a6e22e">is.na</span>(h))){
    H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(L,L,N))
    <span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N){
      <span style="color:#a6e22e">diag</span>(H[,,i]) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    }
  }else <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">class</span>(h)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;array&#34;</span>){
    H <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(h,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">NROW</span>(h),<span style="color:#a6e22e">NCOL</span>(h),N))
  }
  
  <span style="color:#75715e"># fill infinite if observed data is NA</span>
  <span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N){
    miss <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">is.na</span>(y[i,])
    <span style="color:#a6e22e">diag</span>(H[,,i])[miss] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1e+32</span>
  }
  y<span style="color:#a6e22e">[is.na</span>(y)] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
  
  <span style="color:#75715e"># 2.Set Initial Value</span>
  a_fil[,,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> a_int
  sig_fil[,,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> sig_int
  
  <span style="color:#75715e"># 3.Implement Kalman filter</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N){
    <span style="color:#a6e22e">if</span>(<span style="color:#a6e22e">class</span>(z)<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;array&#34;</span>){
      Z <span style="color:#f92672">&lt;-</span> z[,,i]
    }else{
      Z <span style="color:#f92672">&lt;-</span> z
    }
    a_pre[,,i] <span style="color:#f92672">&lt;-</span> t<span style="color:#f92672">%*%</span>a_fil[,,i] <span style="color:#f92672">+</span> c
    sig_pre[,,i] <span style="color:#f92672">&lt;-</span> t<span style="color:#f92672">%*%</span>sig_fil[,,i]<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(t) <span style="color:#f92672">+</span> R<span style="color:#f92672">%*%</span>Q<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(R)
    y_pre[,,i] <span style="color:#f92672">&lt;-</span> Z<span style="color:#f92672">%*%</span>a_pre[,,i] <span style="color:#f92672">+</span> d
    F_pre[,,i] <span style="color:#f92672">&lt;-</span> Z<span style="color:#f92672">%*%</span>sig_pre[,,i]<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(Z) <span style="color:#f92672">+</span> S<span style="color:#f92672">%*%</span>H[,,i]<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(S)
    k[,,i] <span style="color:#f92672">&lt;-</span> sig_pre[,,i]<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(Z)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(F_pre[,,i])
    a_fil[,,i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">&lt;-</span> a_pre[,,i] <span style="color:#f92672">+</span> k[,,i]<span style="color:#f92672">%*%</span>(y[i,]<span style="color:#f92672">-</span>y_pre[,,i])
    sig_fil[,,i<span style="color:#ae81ff">+1</span>] <span style="color:#f92672">&lt;-</span> sig_pre[,,i] <span style="color:#f92672">-</span> k[,,i]<span style="color:#f92672">%*%</span>F_pre[,,i]<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(k[,,i])
  }
  
  <span style="color:#75715e"># 4.Aggregate results</span>
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(a_pre,a_fil,sig_pre,sig_fil,y_pre,k,t,z)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;state prediction&#34;</span>, <span style="color:#e6db74">&#34;state filtered&#34;</span>, <span style="color:#e6db74">&#34;state var prediction&#34;</span>, 
                     <span style="color:#e6db74">&#34;state var filtered&#34;</span>, <span style="color:#e6db74">&#34;observable prediction&#34;</span>, <span style="color:#e6db74">&#34;kalman gain&#34;</span>,
                     <span style="color:#e6db74">&#34;parameter of state eq&#34;</span>, <span style="color:#e6db74">&#34;parameter of observable eq&#34;</span>)
  <span style="color:#a6e22e">return</span>(result)
}
</code></pre></div><p>事前分布を計算する関数を定義します。まず、引数を計算しやすい形に変換しておきます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">  <span style="color:#75715e"># set pi</span>
  <span style="color:#66d9ef">pi</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">5</span>)) <span style="color:#75715e"># hyperparameter</span>
  x <span style="color:#f92672">&lt;-</span> Canada <span style="color:#75715e"># dataset</span>
  order <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">4</span> <span style="color:#75715e"># order</span>
  
  <span style="color:#a6e22e">library</span>(MASS)
    
  <span style="color:#75715e"># 1. Process row data</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>){
    <span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">parse</span>(text <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;pi&#34;</span>,i,<span style="color:#e6db74">&#34;=pi[[&#34;</span>,i,<span style="color:#e6db74">&#34;]]&#34;</span>)))
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">class</span>(x)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;matrix&#34;</span>){
    x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x)
  }
  dependent <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x<span style="color:#a6e22e">[</span>(order<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(x),<span style="color:#ae81ff">1</span>])
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
    dependent <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(dependent,<span style="color:#a6e22e">as.matrix</span>(x<span style="color:#a6e22e">[</span>(order<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(x),i]))
  }
  explanatory <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">embed</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span>,x),order)[,<span style="color:#f92672">-</span>((order<span style="color:#f92672">*</span><span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">+</span>order<span style="color:#f92672">-</span><span style="color:#a6e22e">NCOL</span>(x))<span style="color:#f92672">:</span>(order<span style="color:#f92672">*</span><span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">+</span>order))]
  explanatory <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x))<span style="color:#f92672">%x%</span><span style="color:#a6e22e">as.matrix</span>(explanatory)
  npara <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NCOL</span>(explanatory) <span style="color:#75715e"># the number of parameters/ ncol(x)*(ncol(x)*order + 1(const))</span>
</code></pre></div><p>dependentは非説明変数、explanatoryは説明変数です。ちょうど1式を再現した形になります。</p>
<p>$$
\left(
\begin{array}{cccc}
Y_{1} \<br>
Y_{2} \<br>
\vdots  \<br>
Y_{J} \<br>
\end{array}
\right) = 
\left(
\begin{array}{cccc}
X_{1} &amp; 0 &amp; \ldots &amp; 0 \<br>
0 &amp; X_{2} &amp; \ldots &amp; 0 \<br>
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>
0 &amp; 0 &amp; \ldots &amp; X_{J}
\end{array}
\right) 
\left(
\begin{array}{cccc}
A_{1} \<br>
A_{2} \<br>
\vdots  \<br>
A_{J} \<br>
\end{array}
\right) +
\left(
\begin{array}{cccc}
U_{1} \<br>
U_{2} \<br>
\vdots  \<br>
U_{J} \<br>
\end{array}
\right)
$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># 2. Make Prior matrixes</span>
  r <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(<span style="color:#a6e22e">numeric</span>(npara)) <span style="color:#75715e"># a part of dependent variable in mixed estimation</span>
  iter1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">NCOL</span>(x))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(iter1)){
    iter1[i] <span style="color:#f92672">&lt;-</span> n
    n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> order<span style="color:#f92672">*</span><span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  <span style="color:#a6e22e">for </span>(i in iter1){
    r[i] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  }
  R <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> npara,ncol <span style="color:#f92672">=</span> npara) <span style="color:#75715e"># a part of explanatory variables in mixed estimation</span>
  V <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NROW</span>(explanatory),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NROW</span>(explanatory)) <span style="color:#75715e"># coefficient matrix of var-cov matrix in mixed estimation</span>
  
  V0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">0</span>,nrow <span style="color:#f92672">=</span> npara,ncol <span style="color:#f92672">=</span> npara) <span style="color:#75715e"># Prior for var matrix</span>
  
  <span style="color:#75715e"># PRIOR FOR VAR OF CONSTANT</span>
  sigi <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">NCOL</span>(x)) <span style="color:#75715e"># var of AR(m)</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
    AR <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ar</span>(x[,i],order.max <span style="color:#f92672">=</span> order)
    sigi[i] <span style="color:#f92672">&lt;-</span> AR<span style="color:#f92672">$</span>var.pred
  }
  sigma_AR <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(sigi,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x))
  iter2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>,npara,(<span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">*</span>order<span style="color:#ae81ff">+1</span>))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  <span style="color:#a6e22e">for </span>(i in iter2){
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi3<span style="color:#f92672">*</span>sigi[n]
    n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  
  <span style="color:#75715e"># PRIOR FOR VAR OF AUTOREGRESSIVE PARAMETER</span>
  wi <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># prior weight on s.d. of autoregressive parameter</span>
  k <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># decay parameter</span>
  iter3 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>((<span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">*</span>order))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>;iter3[1] <span style="color:#f92672">&lt;-</span> n
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(iter3)){
    <span style="color:#a6e22e">if </span>((i<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">%%</span>order <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># const</span>
      iter3[i] <span style="color:#f92672">&lt;-</span> n 
    }else{
      n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x)
      iter3[i] <span style="color:#f92672">&lt;-</span> n
    }
  }
  <span style="color:#a6e22e">for </span>(i in iter3) {
    k <span style="color:#f92672">&lt;-</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi1<span style="color:#f92672">/</span>(k<span style="color:#f92672">*</span><span style="color:#a6e22e">exp</span>(pi4<span style="color:#f92672">*</span>wi))
    <span style="color:#a6e22e">if </span>(k <span style="color:#f92672">==</span> order){
      k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    }
  }
  
  <span style="color:#75715e"># PRIOR FOR VAR OF DISTRIBUTED LAG PARAMETER</span>
  wj <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># prior weight on s.d. of distributed lag parameter</span>
  k <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># decay parameter</span>
  count <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  ndis <span style="color:#f92672">&lt;-</span> npara <span style="color:#f92672">-</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">-</span> <span style="color:#a6e22e">length</span>(iter3) <span style="color:#75715e"># the number of distibuted lag in each equation</span>
  
  l <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x),length<span style="color:#f92672">=</span>npara)
  temp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">length</span>(iter3))
  j <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>;temp[1] <span style="color:#f92672">&lt;-</span> j
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(temp)){
    <span style="color:#a6e22e">if </span>((i<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">%%</span>order <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      j <span style="color:#f92672">&lt;-</span> j <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># const</span>
      temp[i] <span style="color:#f92672">&lt;-</span> j 
    }else{
      j <span style="color:#f92672">&lt;-</span> j <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x)
      temp[i] <span style="color:#f92672">&lt;-</span> j
    }
  }
  l <span style="color:#f92672">&lt;-</span> l[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(temp)]; l <span style="color:#f92672">&lt;-</span> l[1<span style="color:#f92672">:</span>(ndis)]
  
  iter4 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>npara; iter4 <span style="color:#f92672">&lt;-</span> iter4[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(iter2,iter3)]
  <span style="color:#a6e22e">for </span>(i in iter4){
    count <span style="color:#f92672">&lt;-</span> count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi2<span style="color:#f92672">*</span>sigi[n]<span style="color:#f92672">/</span>(k<span style="color:#f92672">*</span><span style="color:#a6e22e">exp</span>(pi4<span style="color:#f92672">*</span>wj)<span style="color:#f92672">*</span>sigi[l[count]])
    <span style="color:#a6e22e">if</span>(count<span style="color:#f92672">%%</span>(order<span style="color:#ae81ff">-1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      k <span style="color:#f92672">&lt;-</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    }
    <span style="color:#a6e22e">if </span>(count<span style="color:#f92672">%%</span>(ndis<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
      k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    }
  }

  <span style="color:#75715e"># 3. Estimate OLS</span>
  beta <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ginv</span>((<span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span>explanatory))<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span>dependent
  sig <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.numeric</span>((<span style="color:#a6e22e">NROW</span>(explanatory)<span style="color:#f92672">-</span><span style="color:#a6e22e">NCOL</span>(explanatory))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span>
                      <span style="color:#a6e22e">t</span>(dependent<span style="color:#f92672">-</span>explanatory<span style="color:#f92672">%*%</span>beta)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>
                      (dependent<span style="color:#f92672">-</span>explanatory<span style="color:#f92672">%*%</span>beta))
  
  <span style="color:#75715e"># 4. Implement Mixed Estimation for initial values</span>
  beta_M <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ginv</span>((<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>sig)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>explanatory <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>R)<span style="color:#f92672">%*%</span>
    ((sig)<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>dependent <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>r)
  sig_M <span style="color:#f92672">&lt;-</span> sig<span style="color:#f92672">*</span><span style="color:#a6e22e">ginv</span>((sig)<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>explanatory <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>R)
  
  <span style="color:#75715e"># for kalman filter</span>
  observable <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x<span style="color:#a6e22e">[</span>(order<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(x),]) <span style="color:#75715e"># dependent variable</span>
  coefficient <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> npara,(<span style="color:#a6e22e">NROW</span>(x)<span style="color:#f92672">-</span>order))) <span style="color:#75715e"># explanatory variable</span>
  <span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(<span style="color:#a6e22e">NROW</span>(x)<span style="color:#f92672">-</span>order)){
    <span style="color:#a6e22e">for </span>(k in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
      coefficient[k,(<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>(k<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span>npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x))<span style="color:#f92672">:</span>(k<span style="color:#f92672">*</span>npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x)),i] <span style="color:#f92672">&lt;-</span> explanatory[i,<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x))]
    }
  }
  
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(observable, coefficient, beta_M, sig_M, sigma_AR, V0, order, npara)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;observable&#34;</span>, <span style="color:#e6db74">&#34;coefficient&#34;</span>,<span style="color:#e6db74">&#34;beta_M&#34;</span>, <span style="color:#e6db74">&#34;sig_M&#34;</span>,<span style="color:#e6db74">&#34;sigma_AR&#34;</span>, <span style="color:#e6db74">&#34;V0&#34;</span>,<span style="color:#e6db74">&#34;order&#34;</span>,<span style="color:#e6db74">&#34;npara&#34;</span>)
  
  <span style="color:#a6e22e">return</span>(result)
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">MPrior <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x,order,<span style="color:#66d9ef">pi</span>){
  <span style="color:#75715e">#-------------------------------------------------------------------</span>
  <span style="color:#75715e"># Make Minnesota Prior</span>
  <span style="color:#75715e">#   x - dataset</span>
  <span style="color:#75715e">#   order - max lag of autoregression</span>
  <span style="color:#75715e">#   pi - a set of hyper-parameter of prior matrix</span>
  <span style="color:#75715e">#-------------------------------------------------------------------</span>

  <span style="color:#a6e22e">library</span>(MASS)
    
  <span style="color:#75715e"># 1. Process row data</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>){
    <span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">parse</span>(text <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;pi&#34;</span>,i,<span style="color:#e6db74">&#34;=pi[[&#34;</span>,i,<span style="color:#e6db74">&#34;]]&#34;</span>)))
  }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">class</span>(x)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;matrix&#34;</span>){
    x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x)
  }
  dependent <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x[1<span style="color:#f92672">:</span>(<span style="color:#a6e22e">NROW</span>(x)<span style="color:#f92672">-</span>order),<span style="color:#ae81ff">1</span>])
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
    dependent <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(dependent,<span style="color:#a6e22e">as.matrix</span>(x<span style="color:#a6e22e">[</span>(order<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(x),i]))
  }
  explanatory <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">embed</span>(x,order)[<span style="color:#ae81ff">-1</span>,])
  explanatory <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x))<span style="color:#f92672">%x%</span><span style="color:#a6e22e">as.matrix</span>(explanatory)
  npara <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">NCOL</span>(explanatory) <span style="color:#75715e"># the number of parameters/ ncol(x)*(ncol(x)*order + 1(const))</span>
  
  <span style="color:#75715e"># 2. Make Prior matrixes</span>
  r <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(<span style="color:#a6e22e">numeric</span>(npara)) <span style="color:#75715e"># a part of dependent variable in mixed estimation</span>
  iter1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">NCOL</span>(x))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(iter1)){
    iter1[i] <span style="color:#f92672">&lt;-</span> n
    n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> order<span style="color:#f92672">*</span><span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  <span style="color:#a6e22e">for </span>(i in iter1){
    r[i] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  }
  R <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> npara,ncol <span style="color:#f92672">=</span> npara) <span style="color:#75715e"># a part of explanatory variables in mixed estimation</span>
  V <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NROW</span>(explanatory),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NROW</span>(explanatory)) <span style="color:#75715e"># coefficient matrix of var-cov matrix in mixed estimation</span>
  
  V0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">0</span>,nrow <span style="color:#f92672">=</span> npara,ncol <span style="color:#f92672">=</span> npara) <span style="color:#75715e"># Prior for var matrix</span>
  
  <span style="color:#75715e"># PRIOR FOR VAR OF CONSTANT</span>
  sigi <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">NCOL</span>(x)) <span style="color:#75715e"># var of AR(m)</span>
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
    AR <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ar</span>(x[,i],order.max <span style="color:#f92672">=</span> order)
    sigi[i] <span style="color:#f92672">&lt;-</span> AR<span style="color:#f92672">$</span>var.pred
  }
  sigma_AR <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diag</span>(sigi,nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x))
  iter2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>,npara,(<span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">*</span>order<span style="color:#ae81ff">+1</span>))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  <span style="color:#a6e22e">for </span>(i in iter2){
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi3<span style="color:#f92672">*</span>sigi[n]
    n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  }
  
  <span style="color:#75715e"># PRIOR FOR VAR OF AUTOREGRESSIVE PARAMETER</span>
  wi <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># prior weight on s.d. of autoregressive parameter</span>
  k <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># decay parameter</span>
  iter3 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>((<span style="color:#a6e22e">NCOL</span>(x)<span style="color:#f92672">*</span>order))
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>;iter3[1] <span style="color:#f92672">&lt;-</span> n
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(iter3)){
    <span style="color:#a6e22e">if </span>((i<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">%%</span>order <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># const</span>
      iter3[i] <span style="color:#f92672">&lt;-</span> n 
    }else{
      n <span style="color:#f92672">&lt;-</span> n <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x)
      iter3[i] <span style="color:#f92672">&lt;-</span> n
    }
  }
  <span style="color:#a6e22e">for </span>(i in iter3) {
    k <span style="color:#f92672">&lt;-</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi1<span style="color:#f92672">/</span>(k<span style="color:#f92672">*</span><span style="color:#a6e22e">exp</span>(pi4<span style="color:#f92672">*</span>wi))
    <span style="color:#a6e22e">if </span>(k <span style="color:#f92672">==</span> order){
      k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    }
  }
  
  <span style="color:#75715e"># PRIOR FOR VAR OF DISTRIBUTED LAG PARAMETER</span>
  wj <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># prior weight on s.d. of distributed lag parameter</span>
  k <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># decay parameter</span>
  count <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
  n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
  ndis <span style="color:#f92672">&lt;-</span> npara <span style="color:#f92672">-</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">-</span> <span style="color:#a6e22e">length</span>(iter3) <span style="color:#75715e"># the number of distibuted lag in each equation</span>
  
  l <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x),length<span style="color:#f92672">=</span>npara)
  temp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#a6e22e">length</span>(iter3))
  j <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>;temp[1] <span style="color:#f92672">&lt;-</span> j
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(temp)){
    <span style="color:#a6e22e">if </span>((i<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">%%</span>order <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      j <span style="color:#f92672">&lt;-</span> j <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># const</span>
      temp[i] <span style="color:#f92672">&lt;-</span> j 
    }else{
      j <span style="color:#f92672">&lt;-</span> j <span style="color:#f92672">+</span> <span style="color:#a6e22e">NCOL</span>(x)
      temp[i] <span style="color:#f92672">&lt;-</span> j
    }
  }
  l <span style="color:#f92672">&lt;-</span> l[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(temp)]; l <span style="color:#f92672">&lt;-</span> l[1<span style="color:#f92672">:</span>(ndis)]
  
  iter4 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>npara; iter4 <span style="color:#f92672">&lt;-</span> iter4[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(iter2,iter3)]
  <span style="color:#a6e22e">for </span>(i in iter4){
    count <span style="color:#f92672">&lt;-</span> count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    V0[i,i] <span style="color:#f92672">&lt;-</span> pi5<span style="color:#f92672">*</span>pi2<span style="color:#f92672">*</span>sigi[n]<span style="color:#f92672">/</span>(k<span style="color:#f92672">*</span><span style="color:#a6e22e">exp</span>(pi4<span style="color:#f92672">*</span>wj)<span style="color:#f92672">*</span>sigi[l[count]])
    <span style="color:#a6e22e">if</span>(count<span style="color:#f92672">%%</span>(order<span style="color:#ae81ff">-1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      k <span style="color:#f92672">&lt;-</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    }
    <span style="color:#a6e22e">if </span>(count<span style="color:#f92672">%%</span>(ndis<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
      n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
      k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    }
  }

  <span style="color:#75715e"># 3. Estimate OLS</span>
  beta <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ginv</span>((<span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span>explanatory))<span style="color:#f92672">%*%</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span>dependent
  sig <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.numeric</span>((<span style="color:#a6e22e">NROW</span>(explanatory)<span style="color:#f92672">-</span><span style="color:#a6e22e">NCOL</span>(explanatory))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span>
                      <span style="color:#a6e22e">t</span>(dependent<span style="color:#f92672">-</span>explanatory<span style="color:#f92672">%*%</span>beta)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>
                      (dependent<span style="color:#f92672">-</span>explanatory<span style="color:#f92672">%*%</span>beta))
  
  <span style="color:#75715e"># 4. Implement Mixed Estimation for initial values</span>
  beta_M <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ginv</span>((<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>sig)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>explanatory <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>R)<span style="color:#f92672">%*%</span>
    ((sig)<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>dependent <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>r)
  sig_M <span style="color:#f92672">&lt;-</span> sig<span style="color:#f92672">*</span><span style="color:#a6e22e">ginv</span>((sig)<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span><span style="color:#a6e22e">t</span>(explanatory)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V)<span style="color:#f92672">%*%</span>explanatory <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>(R)<span style="color:#f92672">%*%</span><span style="color:#a6e22e">ginv</span>(V0)<span style="color:#f92672">%*%</span>R)
  
  <span style="color:#75715e"># for kalman filter</span>
  observable <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.matrix</span>(x<span style="color:#a6e22e">[</span>(order<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">NROW</span>(x),]) <span style="color:#75715e"># dependent variable</span>
  coefficient <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(nrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">NCOL</span>(x),ncol <span style="color:#f92672">=</span> npara,(<span style="color:#a6e22e">NROW</span>(x)<span style="color:#f92672">-</span>order))) <span style="color:#75715e"># explanatory variable</span>
  <span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(<span style="color:#a6e22e">NROW</span>(x)<span style="color:#f92672">-</span>order)){
    <span style="color:#a6e22e">for </span>(k in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">NCOL</span>(x)){
      coefficient[k,(<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>(k<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">*</span>npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x))<span style="color:#f92672">:</span>(k<span style="color:#f92672">*</span>npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x)),i] <span style="color:#f92672">&lt;-</span> explanatory[i,<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(npara<span style="color:#f92672">/</span><span style="color:#a6e22e">NCOL</span>(x))]
    }
  }
  
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(observable, coefficient, beta_M, sig_M, sigma_AR, V0, order, npara)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;observable&#34;</span>, <span style="color:#e6db74">&#34;coefficient&#34;</span>,<span style="color:#e6db74">&#34;beta_M&#34;</span>, <span style="color:#e6db74">&#34;sig_M&#34;</span>,<span style="color:#e6db74">&#34;sigma_AR&#34;</span>, <span style="color:#e6db74">&#34;V0&#34;</span>,<span style="color:#e6db74">&#34;order&#34;</span>,<span style="color:#e6db74">&#34;npara&#34;</span>)
  
  <span style="color:#a6e22e">return</span>(result)
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">BVAR <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(m){
  <span style="color:#75715e">#-------------------------------------------------------------------</span>
  <span style="color:#75715e"># Estimation of Bayesian Vector Auto-Regression</span>
  <span style="color:#75715e">#   m - dataset</span>
  <span style="color:#75715e">#-------------------------------------------------------------------</span>
  
  <span style="color:#75715e"># 1. Process data</span>
  observable <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>observable
  coefficient <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>coefficient
  beta_M <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>beta_M
  sig_M <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>sig_M
  sigma_AR <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>sigma_AR
  V0 <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>V0
  order <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>order
  npara <span style="color:#f92672">&lt;-</span> m<span style="color:#f92672">$</span>npara
  
  <span style="color:#75715e"># 2. Run Kalmanfilter</span>
  results <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">kalmanfiter</span>(observable,npara,<span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,nrow <span style="color:#f92672">=</span> npara,ncol <span style="color:#f92672">=</span> npara),
                         coefficient,<span style="color:#ae81ff">0</span>,<span style="color:#66d9ef">NA</span>,V0,<span style="color:#ae81ff">0</span>,<span style="color:#66d9ef">NA</span>,sigma_AR,beta_M,sig_M)
  <span style="color:#a6e22e">return</span>(results)
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">MPrior</span>(Canada,<span style="color:#ae81ff">3</span>,<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">5</span>)))
results <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">BVAR</span>(m)

BVAR_Prediction <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(results,horizon){
  
  state_pred <span style="color:#f92672">&lt;-</span> results<span style="color:#f92672">$</span>`state prediction`
  state_fil <span style="color:#f92672">&lt;-</span> results<span style="color:#f92672">$</span>`state filtered`
  obs_pred <span style="color:#f92672">&lt;-</span> results<span style="color:#f92672">$</span>`observable prediction`
  A <span style="color:#f92672">&lt;-</span> results<span style="color:#f92672">$</span>`parameter of state eq`
    
  nparaall <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dim</span>(state_pred)[1]
  num <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dim</span>(obs_pred)[1]
  npara <span style="color:#f92672">&lt;-</span> order<span style="color:#f92672">*</span>num<span style="color:#ae81ff">+1</span>
  order <span style="color:#f92672">&lt;-</span> (nparaall<span style="color:#f92672">-</span>num)<span style="color:#f92672">/</span>(num^2)
  samplesize <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dim</span>(state_pred)[3]
  
  y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">0</span>,horizon,num)
  B <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">0</span>,horizon,nparaall)
  x <span style="color:#f92672">&lt;-</span> results<span style="color:#f92672">$</span>`parameter of observable eq`[1,<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>npara,samplesize]
  
  B[1,] <span style="color:#f92672">&lt;-</span> state_fil[,<span style="color:#ae81ff">1</span>,samplesize]
  
  <span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(horizon<span style="color:#ae81ff">-1</span>)) {
    B[i<span style="color:#ae81ff">+1</span>,] <span style="color:#f92672">&lt;-</span> A<span style="color:#f92672">%*%</span>B[i,]
    y[i<span style="color:#ae81ff">+1</span>,] <span style="color:#f92672">&lt;-</span> B[i<span style="color:#ae81ff">+1</span>,]<span style="color:#f92672">%*%</span>(<span style="color:#a6e22e">diag</span>(<span style="color:#ae81ff">1</span>,num)<span style="color:#f92672">%x%</span>x)
    x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,y[i<span style="color:#ae81ff">+1</span>,],x[<span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">seq</span>(from<span style="color:#f92672">=</span>(npara<span style="color:#f92672">-</span>order),to<span style="color:#f92672">=</span>npara))])
  }
  
  result <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(B,y)
  <span style="color:#a6e22e">names</span>(result) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;B&#34;</span>,<span style="color:#e6db74">&#34;y&#34;</span>)
  
  <span style="color:#a6e22e">return</span>(result)
  
}

pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">BVAR_Prediction</span>(results,<span style="color:#ae81ff">20</span>)

BVAR_OPT <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x){
  int_pi <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">5</span>)
  
}
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Sims, Christopher A, 1980. &ldquo;Macroeconomics and Reality,&rdquo; Econometrica, Econometric Society, vol. 48(1), pages 1-48, January. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

          </div>

          






<div class="article-tags">
  
  <a class="badge badge-light" href="../../tag/bvar/">BVAR</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=../../post/post5/&amp;text=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/post5/&amp;t=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&amp;body=/post/post5/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=../../post/post5/&amp;title=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%20/post/post5/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=../../post/post5/&amp;title=BVAR%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="../../"><img class="avatar mr-3 avatar-circle" src="../../author/ayato-ashihara/avatar_hu77c0c0affdebd3b9cbda9c39412092b5_245163_270x270_fill_q90_lanczos_center.jpg" alt="Ayato Ashihara"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="../../">Ayato Ashihara</a></h5>
      <h6 class="card-subtitle">会社員4年目</h6>
      <p class="card-text">院卒4年目の社会人が夜な夜な更新中。本ブログの内容は筆者が所属する組織の公式見解とは全く関係ありません。</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="../../#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.facebook.com/ASSIY" target="_blank" rel="noopener">
        <i class="fab fa-facebook"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/AyatoAshihara/myblog_multi" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/%E5%BD%A9%E4%BA%BA-%E8%91%A6%E5%8E%9F-9391b7143/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "ayatoashihara-github-io-myblog-multi" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>








  
  





        </div>
      </article>
    </main>

  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.0/mermaid.min.js" integrity="sha512-ja+hSBi4JDtjSqc4LTBsSwuBT3tdZ3oKYKd07lTVYmCnTCor56AnRql00ssqnTOR9Ss4gOP/ROGB3SfcJnZkeg==" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/SQL.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/C&#43;&#43;.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"結果が見つかりませんでした","placeholder":"検索...","results":"results found"};
      const content_type = {
        'post': "投稿",
        'project': "プロジェクト",
        'publication' : "発表文献",
        'talk' : "登壇",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://ayatoashihara-github-io-myblog-multi.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="../../js/wowchemy.min.4c2bca31150ce93c5a5e43b8a50f22fd.js"></script>

    


  
  
  <div class="container">
    <footer class="site-footer">
  

  
   
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "show");
  });
  </script>
  <script src="../../js/codefolding.js"></script>


  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy</a>  —
    the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">
    open source</a> website builder that empowers creators.
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> コピー
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> ダウンロード
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
