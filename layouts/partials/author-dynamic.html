{{/*
  Partial: author-dynamic.html
  Accepts context where `.` is an author Page (or a dict with "author_page").
  Outputs a short paragraph with work years and age computed from front matter.
*/}}
{{ $author := . }}
{{ with .author_page }}{{ $author = . }}{{ end }}
{{ if not $author }}{{/* nothing to render */}}{{ end }}
{{ $now := now }}
{{ $currentYear := (dateFormat "2006" $now) | int }}
{{ $parts := slice }}
{{/* Determine language: prefer author page language, else site language */}}
{{ $lang := default .Site.Language.Lang $author.Lang }}

{{ with $author.Params.work_start_year }}
  {{ $start := . | int }}
  {{ $years := sub $currentYear $start }}
  {{ if eq $lang "en" }}
    {{ $parts = $parts | append (printf "Started work in %d; currently in year %d of professional career." $start $years) }}
  {{ else }}
    {{ $parts = $parts | append (printf "%d年に社会人となり、現在は社会人%d年目です。" $start $years) }}
  {{ end }}
{{ end }}

{{ with $author.Params.birthdate }}
  {{ $birth := time . }}
  {{ $byear := (dateFormat "2006" $birth) | int }}
  {{ $bmd := dateFormat "0102" $birth }}
  {{ $nowmd := dateFormat "0102" $now }}
  {{ $age := sub $currentYear $byear }}
  {{ if lt $nowmd $bmd }}
    {{ $age = sub $age 1 }}
  {{ end }}
  {{ if eq $lang "en" }}
    {{ $parts = $parts | append (printf "Born on %s and currently %d years old." (dateFormat "January 2, 2006" $birth) $age) }}
  {{ else }}
    {{ $parts = $parts | append (printf "%s生まれで現在%d歳です。" (dateFormat "2006年1月2日" $birth) $age) }}
  {{ end }}
{{ end }}

{{ if gt (len $parts) 0 }}
  {{ delimit $parts " " }}
{{ end }}
